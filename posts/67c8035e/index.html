<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>MyBatis-Plus | xw的妙妙屋</title><meta name="author" content="xw"><meta name="copyright" content="xw"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="一、MyBatis-Plus 简介 1.1 什么是 MyBatis-Plus MyBatis-Plus（简称 MP）是 MyBatis 的增强工具，由 baomidou 团队开发维护，核心设计理念是 “只做增强，不做改变”—— 完全兼容 MyBatis 原生功能，不侵入现有代码，同时封装了大量重复的单表 CRUD 操作，让开发者无需手写繁琐的 SQL 或 XML 映射文件，即可快速完成业务开发。">
<meta property="og:type" content="article">
<meta property="og:title" content="MyBatis-Plus">
<meta property="og:url" content="https://www.xwybq.top/posts/67c8035e/index.html">
<meta property="og:site_name" content="xw的妙妙屋">
<meta property="og:description" content="一、MyBatis-Plus 简介 1.1 什么是 MyBatis-Plus MyBatis-Plus（简称 MP）是 MyBatis 的增强工具，由 baomidou 团队开发维护，核心设计理念是 “只做增强，不做改变”—— 完全兼容 MyBatis 原生功能，不侵入现有代码，同时封装了大量重复的单表 CRUD 操作，让开发者无需手写繁琐的 SQL 或 XML 映射文件，即可快速完成业务开发。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://a1.boltp.com/2025/09/19/68cd666550457.png">
<meta property="article:published_time" content="2025-09-19T07:31:42.000Z">
<meta property="article:modified_time" content="2025-09-19T14:19:44.160Z">
<meta property="article:author" content="xw">
<meta property="article:tag" content="MyBatis-Plus">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://a1.boltp.com/2025/09/19/68cd666550457.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "MyBatis-Plus",
  "url": "https://www.xwybq.top/posts/67c8035e/",
  "image": "https://a1.boltp.com/2025/09/19/68cd666550457.png",
  "datePublished": "2025-09-19T07:31:42.000Z",
  "dateModified": "2025-09-19T14:19:44.160Z",
  "author": [
    {
      "@type": "Person",
      "name": "xw",
      "url": "https://www.xwybq.top"
    }
  ]
}</script><link rel="shortcut icon" href="/image/%E4%B8%89%E8%8A%B1%E7%8C%AB.png"><link rel="canonical" href="https://www.xwybq.top/posts/67c8035e/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MyBatis-Plus',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/styles/main.css"><script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script><link rel="stylesheet" href="/css/daliyuer.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/twikoo_beauty.css"><link rel="stylesheet" href="/css/beauty.css"><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="/css/custom_code.css"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='screen'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="xw的妙妙屋" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/headshot.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">12</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">14</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/bangumis/"><i class="fa-fw fa-brands fa-youtube"></i><span> 番剧</span></a></div><div class="menus_item"><a class="site-page" href="/steamgames/"><i class="fa-fw fa-brands fa-steam"></i><span> 游戏库</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-solid fa-image"></i><span> 相册</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://a1.boltp.com/2025/09/19/68cd666550457.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/test.gif" alt="Logo"><span class="site-name">xw的妙妙屋</span></a><a class="nav-page-title" href="/"><span class="site-name">MyBatis-Plus</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="weather"><div id="tp-weather-widget"></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/bangumis/"><i class="fa-fw fa-brands fa-youtube"></i><span> 番剧</span></a></div><div class="menus_item"><a class="site-page" href="/steamgames/"><i class="fa-fw fa-brands fa-steam"></i><span> 游戏库</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-solid fa-image"></i><span> 相册</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> 关于</span></a></div></div></div><div id="nav-right"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><!-- span= ' ' + _p('search.title')--></span></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">MyBatis-Plus</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-09-19T07:31:42.000Z" title="发表于 2025-09-19 15:31:42">2025-09-19</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-09-19T14:19:44.160Z" title="更新于 2025-09-19 22:19:44">2025-09-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Java/">Java</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="twikoo_visitors"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://a1.boltp.com/2025/09/19/68cd62dc54ff0.png" alt=""></p>
<h1>一、MyBatis-Plus 简介</h1>
<h2 id="1-1-什么是-MyBatis-Plus">1.1 什么是 MyBatis-Plus</h2>
<p>MyBatis-Plus（简称 MP）是 <strong>MyBatis 的增强工具</strong>，由 baomidou 团队开发维护，核心设计理念是 <strong>“只做增强，不做改变”</strong>—— 完全兼容 MyBatis 原生功能，不侵入现有代码，同时封装了大量重复的单表 CRUD 操作，让开发者无需手写繁琐的 SQL 或 XML 映射文件，即可快速完成业务开发。</p>
<p>正如其 slogan “TO BE THE BEST PARTNER OF MYBATIS” 所传递的，MP 并非替代 MyBatis，而是作为其 “最佳搭档” 存在。PPT 中用 “润物无声，如丝般顺滑” 形容其特性，恰是因为引入后不会对现有 MyBatis 工程产生任何干扰，原有代码可无缝衔接。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://a1.boltp.com/2025/09/19/68cd45631d581.png" alt=""></p>
<h2 id="1-2-核心特性">1.2 核心特性</h2>
<p>MP 的核心价值集中在 “简化开发” 与 “效率提升”，结合课程内容可归纳为以下 6 点：</p>
<ul>
<li><strong>无侵入性</strong>：基于 MyBatis 原生架构扩展，不修改 MyBatis 核心逻辑，现有工程引入后无需重构代码。</li>
<li><strong>效率至上</strong>：内置 <code>BaseMapper</code>（DAO 层）和 <code>IService</code>（Service 层）接口，封装了全量单表 CRUD 操作（新增、删除、查询、更新等），实现 “零 SQL 开发”。</li>
<li><strong>智能映射</strong>：默认遵循 “驼峰 - 下划线” 转换规则（类名→表名、变量名→字段名），默认将<code>id</code>字段作为主键，减少手动配置成本。</li>
<li><strong>灵活条件构造</strong>：提供 <code>QueryWrapper</code>、<code>LambdaQueryWrapper</code> 等条件构造器，支持动态拼接复杂 WHERE 条件，避免字符串拼接 SQL 的语法错误风险。</li>
<li><strong>丰富扩展功能</strong>：内置代码生成、逻辑删除、枚举字段映射、JSON 字段处理等高频场景工具，覆盖日常开发痛点。</li>
<li><strong>可插拔插件</strong>：支持分页、乐观锁、多租户、动态表名等插件，通过简单配置即可启用，扩展性极强。</li>
</ul>
<h2 id="1-3-支持的数据库">1.3 支持的数据库</h2>
<p>兼容所有 MyBatis 支持的关系型数据库，覆盖主流及企业级场景：</p>
<table>
<thead>
<tr>
<th>数据库类型</th>
<th>适配说明</th>
<th>典型使用场景</th>
</tr>
</thead>
<tbody>
<tr>
<td>MySQL</td>
<td>适配 5.5+ / 8.0+ 版本</td>
<td>互联网应用、中小项目</td>
</tr>
<tr>
<td>Oracle</td>
<td>支持 11g+ 版本</td>
<td>企业级系统</td>
</tr>
<tr>
<td>SQL Server</td>
<td>兼容 2008+ 版本</td>
<td>微软技术栈项目</td>
</tr>
<tr>
<td>PostgreSQL</td>
<td>支持 9.4+ 版本，适配 JSON 字段</td>
<td>开源企业级项目</td>
</tr>
<tr>
<td>SQLite</td>
<td>适配 3.7+ 版本</td>
<td>轻量级应用、嵌入式系统</td>
</tr>
<tr>
<td>DB2</td>
<td>支持 10.5+ 版本</td>
<td>大型金融、政务系统</td>
</tr>
</tbody>
</table>
<h2 id="1-4-框架结构">1.4 框架结构</h2>
<p>MP 基于 MyBatis 分层设计，整体结构清晰，可拆解为 4 个核心层级：</p>
<ol>
<li><strong>底层依赖层</strong>：依赖 MyBatis 核心包、JDBC 驱动及 Spring 生态组件（如 Spring Boot Starter），确保与 Java 主流开发环境无缝集成。</li>
<li><strong>核心功能层</strong>：MP 的 “心脏”，包含三大核心能力：
<ul>
<li>通用 CRUD 接口：<code>BaseMapper</code>（提供单表 DAO 层操作）、<code>IService</code>（提供 Service 层批量操作、逻辑封装）；</li>
<li>实体映射：基于注解（<code>@TableName</code>、<code>@TableId</code> 等）实现表与实体类的关联；</li>
<li>条件构造：<code>Wrapper</code> 家族接口，动态生成 WHERE 条件。</li>
</ul>
</li>
<li><strong>扩展功能层</strong>：针对高频需求的封装，如代码生成器（自动生成 Entity、Mapper、Service 等代码）、逻辑删除（模拟删除效果，不真正删数据）、枚举 / JSON 处理器（解决特殊字段类型映射问题）。</li>
<li><strong>插件层</strong>：基于 MyBatis 拦截器实现，提供分页（<code>PaginationInnerInterceptor</code>）、乐观锁（<code>OptimisticLockerInnerInterceptor</code>）、防止全表删除（<code>BlockAttackInnerInterceptor</code>）等插件，按需配置启用。</li>
</ol>
<h2 id="1-5-官方资源">1.5 官方资源</h2>
<ul>
<li><strong>官网</strong>：<a target="_blank" rel="noopener" href="https://baomidou.com/">https://baomidou.com/</a> （核心文档、更新日志、生态工具入口，信息最权威）</li>
<li><strong>参考文档</strong>：<a target="_blank" rel="noopener" href="https://mybatis.plus/%EF%BC%88%E5%90%AB%E8%AF%A6%E7%BB%86%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97%E3%80%81API">https://mybatis.plus/（含详细配置指南、API</a> 说明、案例教程）</li>
<li><strong>GitHub 仓库</strong>：<a target="_blank" rel="noopener" href="https://github.com/baomidou/mybatis-plus">https://github.com/baomidou/mybatis-plus</a> （源码地址、issue 反馈、贡献指南）</li>
</ul>
<h1>二、MyBatis-Plus 快速入门</h1>
<h2 id="2-1-环境准备">2.1 环境准备</h2>
<h3 id="2-1-1-数据库初始化">2.1.1 数据库初始化</h3>
<p>导入课前提供的<code>mp.sql</code>脚本，创建<code>mp</code>数据库及 3 张核心表，表结构与核心数据如下：</p>
<table>
<thead>
<tr>
<th>表名</th>
<th>作用</th>
<th>核心字段说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>user</code></td>
<td>核心用户表</td>
<td><code>id</code>(主键)、<code>username</code>(用户名)、<code>info</code>(JSON 详情)、<code>status</code>(状态)、<code>balance</code>(余额)</td>
</tr>
<tr>
<td><code>address</code></td>
<td>用户地址表</td>
<td><code>id</code>、<code>user_id</code>(外键关联 <a target="_blank" rel="noopener" href="http://user.id">user.id</a>)、<code>province</code>(省)、<code>city</code>(市)、<code>is_default</code>(默认地址)</td>
</tr>
<tr>
<td><code>tb_user</code></td>
<td>注解测试专用表</td>
<td><code>user_id</code>(主键)、<code>username</code>、<code>is_deleted</code>(逻辑删除标记)、<code>order</code>(排序字段)</td>
</tr>
</tbody>
</table>
<p><strong>核心表结构示例（user 表）</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> `<span class="hljs-keyword">user</span>` (<br>	`id` <span class="hljs-type">BIGINT</span>(<span class="hljs-number">19</span>) <span class="hljs-keyword">NOT NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">&#x27;用户id&#x27;</span>,<br>	`username` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;用户名&#x27;</span>,<br>	`password` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;密码&#x27;</span>,<br>	`phone` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;注册手机号&#x27;</span>,<br>	`info` JSON <span class="hljs-keyword">NOT NULL</span> COMMENT <span class="hljs-string">&#x27;详细信息&#x27;</span>,<br>	`status` <span class="hljs-type">INT</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;1&#x27;</span> COMMENT <span class="hljs-string">&#x27;使用状态（1正常 2冻结）&#x27;</span>,<br>	`balance` <span class="hljs-type">INT</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;账户余额&#x27;</span>,<br>	`create_time` DATETIME <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;创建时间&#x27;</span>,<br>	`update_time` DATETIME <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;更新时间&#x27;</span>,<br>	<span class="hljs-keyword">PRIMARY KEY</span> (`id`) <span class="hljs-keyword">USING</span> BTREE,<br>	<span class="hljs-keyword">UNIQUE</span> INDEX `username` (`username`) <span class="hljs-keyword">USING</span> BTREE<br>) COMMENT<span class="hljs-operator">=</span><span class="hljs-string">&#x27;用户表&#x27;</span>;<br></code></pre></td></tr></table></figure>
<h3 id="2-1-2-项目导入与配置">2.1.2 项目导入与配置</h3>
<ol>
<li><strong>导入项目</strong>：加载<code>mp-demo</code>项目结构，确保核心包路径为<code>com.itheima.mp</code>（含<code>domain.po</code>、<code>mapper</code>等子包）。</li>
<li><strong>配置数据库连接</strong>：修改<code>application.yaml</code>中的 JDBC 参数，适配本地数据库环境：</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://127.0.0.1:3307/mp?useUnicode=true&amp;characterEncoding=UTF-8&amp;autoReconnect=true&amp;serverTimezone=Asia/Shanghai</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>  <span class="hljs-comment"># 替换为本地用户名</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span>  <span class="hljs-comment"># 替换为本地密码</span><br><span class="hljs-attr">logging:</span><br>  <span class="hljs-attr">level:</span><br>    <span class="hljs-attr">com.itheima:</span> <span class="hljs-string">debug</span>  <span class="hljs-comment"># 打印SQL日志，便于调试</span><br>  <span class="hljs-attr">pattern:</span><br>    <span class="hljs-attr">dateformat:</span> <span class="hljs-string">HH:mm:ss</span><br></code></pre></td></tr></table></figure>
<h2 id="2-2-MyBatis-项目改造为-MyBatis-Plus">2.2 MyBatis 项目改造为 MyBatis-Plus</h2>
<p>基于现有 MyBatis 项目，通过 3 步改造即可实现<code>user</code>表的 CRUD 功能，核心是利用 MP 的<code>BaseMapper</code>省去手动编写 SQL 的工作。</p>
<h3 id="2-2-1-步骤-1：替换依赖">2.2.1 步骤 1：替换依赖</h3>
<p>MP 提供了 Spring Boot Starter，集成了 MyBatis 核心功能并实现自动装配，直接替换原 MyBatis 依赖：</p>
<h4 id="Spring-Boot-2-x-依赖">Spring Boot 2.x 依赖</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- MyBatis-Plus Starter（替换mybatis-spring-boot-starter） --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.9<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!-- 其他必要依赖 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h4 id="Spring-Boot-3-x-依赖">Spring Boot 3.x 依赖</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-spring-boot3-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.9<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h3 id="2-2-2-步骤-2：配置-Mapper-扫描">2.2.2 步骤 2：配置 Mapper 扫描</h3>
<p>在 Spring Boot 启动类上添加<code>@MapperScan</code>注解，指定 Mapper 接口所在包：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.mybatis.spring.annotation.MapperScan;<br><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<br><br><span class="hljs-meta">@MapperScan(&quot;com.itheima.mp.mapper&quot;)</span>  <span class="hljs-comment">// 扫描Mapper接口</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MpDemoApplication</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(MpDemoApplication.class, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="2-2-3-步骤-3：定义-Mapper-接口（核心改造）">2.2.3 步骤 3：定义 Mapper 接口（核心改造）</h3>
<p>MP 的<code>BaseMapper</code>接口已封装所有单表 CRUD 方法，只需让自定义 Mapper 继承它即可，无需编写 XML 映射文件。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://a1.boltp.com/2025/09/19/68cd2f3da98a1.png" alt=""></p>
<h4 id="改造前（MyBatis）">改造前（MyBatis）</h4>
<p>需手动定义 CRUD 方法及 XML：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Mapper接口</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveUser</span><span class="hljs-params">(User user)</span>;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteUser</span><span class="hljs-params">(Long id)</span>;<br>    User <span class="hljs-title function_">queryUserById</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;id&quot;)</span> Long id)</span>;<br>    List&lt;User&gt; <span class="hljs-title function_">queryUserByIds</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;ids&quot;)</span> List&lt;Long&gt; ids)</span>;<br>&#125;<br><br><span class="hljs-comment">// 对应的XML映射文件（需编写大量SQL）</span><br>&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;<br>&lt;!DOCTYPE mapper PUBLIC <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;<br>&lt;mapper namespace=<span class="hljs-string">&quot;com.itheima.mp.mapper.UserMapper&quot;</span>&gt;<br>    &lt;insert id=<span class="hljs-string">&quot;saveUser&quot;</span> parameterType=<span class="hljs-string">&quot;com.itheima.mp.domain.po.User&quot;</span>&gt;<br>        INSERT INTO `user` (`id`, `username`, `password`) VALUES (#&#123;id&#125;, #&#123;username&#125;, #&#123;password&#125;);<br>    &lt;/insert&gt;<br>    &lt;!-- 省略其他UPDATE/DELETE/SELECT标签 --&gt;<br>&lt;/mapper&gt;<br></code></pre></td></tr></table></figure>
<h4 id="改造后（MyBatis-Plus）">改造后（MyBatis-Plus）</h4>
<p>仅需继承<code>BaseMapper</code>，零 SQL 实现 CRUD：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;<br><span class="hljs-keyword">import</span> com.itheima.mp.domain.po.User;<br><br><span class="hljs-comment">// 继承BaseMapper，泛型指定PO实体类</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapper</span>&lt;User&gt; &#123;<br>    <span class="hljs-comment">// 无需手动写任何方法，BaseMapper已全部封装</span><br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="2-2-4-改造效果测试">2.2.4 改造效果测试</h3>
<p>通过单元测试验证 MP 的 CRUD 能力，对比 MyBatis 实现，代码量大幅减少：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyBatisPlusUserMapperTests</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserMapper userMapper;<br><br>    <span class="hljs-comment">// 新增用户</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testInsert</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>        user.setId(<span class="hljs-number">5L</span>);<br>        user.setUsername(<span class="hljs-string">&quot;Lucy&quot;</span>);<br>        user.setPassword(<span class="hljs-string">&quot;123&quot;</span>);<br>        user.setInfo(<span class="hljs-string">&quot;&#123;\&quot;age\&quot;: 24, \&quot;intro\&quot;: \&quot;英文老师\&quot;, \&quot;gender\&quot;: \&quot;female\&quot;&#125;&quot;</span>);<br>        userMapper.insert(user);  <span class="hljs-comment">// MP自带方法</span><br>    &#125;<br><br>    <span class="hljs-comment">// 根据ID查询</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSelectById</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userMapper.selectById(<span class="hljs-number">5L</span>);  <span class="hljs-comment">// MP自带方法</span><br>        System.out.println(<span class="hljs-string">&quot;user = &quot;</span> + user);<br>    &#125;<br><br>    <span class="hljs-comment">// 批量查询</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSelectByIds</span><span class="hljs-params">()</span> &#123;<br>        List&lt;User&gt; users = userMapper.selectBatchIds(List.of(<span class="hljs-number">1L</span>, <span class="hljs-number">2L</span>, <span class="hljs-number">3L</span>));  <span class="hljs-comment">// MP自带方法</span><br>        users.forEach(System.out::println);<br>    &#125;<br><br>    <span class="hljs-comment">// 更新用户</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testUpdateById</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>        user.setId(<span class="hljs-number">5L</span>);<br>        user.setBalance(<span class="hljs-number">20000</span>);<br>        userMapper.updateById(user);  <span class="hljs-comment">// MP自带方法</span><br>    &#125;<br><br>    <span class="hljs-comment">// 删除用户</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testDelete</span><span class="hljs-params">()</span> &#123;<br>        userMapper.deleteById(<span class="hljs-number">5L</span>);  <span class="hljs-comment">// MP自带方法</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><strong>SQL 日志示例</strong>（MP 自动生成标准 SQL，避免<code>SELECT *</code>）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">11:54:23 DEBUG c.i.mp.mapper.UserMapper.selectBatchIds  : ==&gt;  Preparing: SELECT id,username,password,phone,info,status,balance,create_time,update_time FROM user WHERE id IN ( ? , ? , ? )<br>11:54:23 DEBUG c.i.mp.mapper.UserMapper.selectBatchIds  : ==&gt; Parameters: 1(Long), 2(Long), 3(Long)<br>11:54:23 DEBUG c.i.mp.mapper.UserMapper.selectBatchIds  : &lt;==      Total: 3<br></code></pre></td></tr></table></figure>
<h2 id="2-3-常见注解">2.3 常见注解</h2>
<p>MP 通过反射推断 PO 与数据库表的映射关系，但默认约定（类名驼峰转表名、<code>id</code>为主键等）可能与实际不符，需通过注解手动声明映射规则。</p>
<h3 id="2-3-1-核心注解说明">2.3.1 核心注解说明</h3>
<h4 id="1-TableName：指定表名">1. @TableName：指定表名</h4>
<p>当 PO 类名与数据库表名不一致时使用，标识实体类对应的表。</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>作用</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>value</code></td>
<td>表名</td>
<td><code>@TableName(&quot;tb_user&quot;)</code></td>
</tr>
<tr>
<td><code>autoResultMap</code></td>
<td>自动构建 ResultMap（适配 JSON 等特殊字段）</td>
<td><code>@TableName(value=&quot;tb_user&quot;, autoResultMap=true)</code></td>
</tr>
</tbody>
</table>
<h4 id="2-TableId：指定主键">2. @TableId：指定主键</h4>
<p>标识实体类的主键字段，支持自定义主键策略。</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>作用</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>value</code></td>
<td>主键字段名（与 PO 不一致时）</td>
<td><code>@TableId(&quot;user_id&quot;)</code></td>
</tr>
<tr>
<td><code>type</code></td>
<td>主键生成策略</td>
<td><code>@TableId(type = IdType.AUTO)</code></td>
</tr>
</tbody>
</table>
<p><strong>主键策略（IdType 枚举核心值）</strong>：</p>
<ul>
<li><code>AUTO</code>：数据库自增（需表主键设置自增）</li>
<li><code>ASSIGN_ID</code>：雪花算法生成全局唯一 Long 型 ID（默认策略）</li>
<li><code>INPUT</code>：手动设置主键值</li>
</ul>
<h4 id="3-TableField：指定普通字段">3. @TableField：指定普通字段</h4>
<p>解决字段名不一致、关键字冲突、非数据库字段等问题，常见场景：</p>
<table>
<thead>
<tr>
<th>场景</th>
<th>解决方案</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td>字段名不一致</td>
<td>指定<code>value</code>属性对应数据库字段</td>
<td><code>@TableField(&quot;username&quot;) private String name;</code></td>
</tr>
<tr>
<td>字段名含关键字（如<code>order</code>）</td>
<td>用`转义</td>
<td><code>@TableField(&quot;</code>order<code>&quot;) private Integer order;</code></td>
</tr>
<tr>
<td>字段非数据库表字段</td>
<td>设置<code>exist=false</code></td>
<td><code>@TableField(exist = false) private String address;</code></td>
</tr>
<tr>
<td>布尔字段以<code>is</code>开头（如<code>isDeleted</code>）</td>
<td>避免 JavaBean 解析丢失<code>is</code></td>
<td><code>@TableField(&quot;is_deleted&quot;) private Boolean isDeleted;</code></td>
</tr>
</tbody>
</table>
<h3 id="2-3-2-注解使用案例">2.3.2 注解使用案例</h3>
<p>以<code>tb_user</code>表（注解测试表）为例，实现 PO 与表的完整映射：</p>
<h4 id="1-定义-PO-实体类（MpUser）">1. 定义 PO 实体类（MpUser）</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.*;<br><span class="hljs-keyword">import</span> lombok.Data;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@TableName(&quot;tb_user&quot;)</span>  <span class="hljs-comment">// 指定表名为tb_user（与类名MpUser不一致）</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MpUser</span> &#123;<br>    <span class="hljs-comment">// 主键：表字段为user_id，策略为数据库自增</span><br>    <span class="hljs-meta">@TableId(value = &quot;user_id&quot;, type = IdType.AUTO)</span><br>    <span class="hljs-keyword">private</span> Long id;<br><br>    <span class="hljs-comment">// 普通字段：PO属性name对应表字段username</span><br>    <span class="hljs-meta">@TableField(&quot;username&quot;)</span><br>    <span class="hljs-keyword">private</span> String name;<br><br>    <span class="hljs-comment">// 普通字段：与表字段一致，无需注解</span><br>    <span class="hljs-keyword">private</span> String password;<br><br>    <span class="hljs-comment">// 布尔字段：isDeleted对应表字段is_deleted</span><br>    <span class="hljs-meta">@TableField(&quot;is_deleted&quot;)</span><br>    <span class="hljs-keyword">private</span> Boolean isDeleted;<br><br>    <span class="hljs-comment">// 关键字字段：order对应表字段`order`（转义）</span><br>    <span class="hljs-meta">@TableField(&quot;`order`&quot;)</span><br>    <span class="hljs-keyword">private</span> Integer order;<br><br>    <span class="hljs-comment">// 非数据库字段：不参与映射</span><br>    <span class="hljs-meta">@TableField(exist = false)</span><br>    <span class="hljs-keyword">private</span> String address;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="2-测试注解效果">2. 测试注解效果</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MpUserMapperTests</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> MpUserMapper mpUserMapper;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testInsert</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">MpUser</span> <span class="hljs-variable">mpUser</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MpUser</span>();<br>        mpUser.setName(<span class="hljs-string">&quot;MP用户1&quot;</span>);  <span class="hljs-comment">// 对应username字段</span><br>        mpUser.setOrder(<span class="hljs-number">1</span>);  <span class="hljs-comment">// 自动转义为`order`</span><br>        mpUser.setAddress(<span class="hljs-string">&quot;测试地址&quot;</span>);  <span class="hljs-comment">// 非数据库字段，不插入</span><br>        mpUserMapper.insert(mpUser);<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSelectById</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">MpUser</span> <span class="hljs-variable">mpUser</span> <span class="hljs-operator">=</span> mpUserMapper.selectById(<span class="hljs-number">1L</span>);<br>        System.out.println(mpUser);  <span class="hljs-comment">// address字段为null，不参与查询</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="2-4-常见配置">2.4 常见配置</h2>
<p>MP 支持通过<code>application.yaml</code>自定义全局配置，覆盖默认行为，核心配置项如下：</p>
<h3 id="2-4-1-核心配置示例">2.4.1 核心配置示例</h3>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">mybatis-plus:</span><br>  <span class="hljs-comment"># 1. 别名扫描：给PO包注册别名，XML中可直接用类名</span><br>  <span class="hljs-attr">type-aliases-package:</span> <span class="hljs-string">com.itheima.mp.domain.po</span><br>  <span class="hljs-comment"># 2. Mapper XML路径：自定义SQL需配置（默认classpath*:/mapper/**/*.xml）</span><br>  <span class="hljs-attr">mapper-locations:</span> <span class="hljs-string">&quot;classpath*:/mapper/**/*.xml&quot;</span><br>  <span class="hljs-comment"># 3. MyBatis原生配置</span><br>  <span class="hljs-attr">configuration:</span><br>    <span class="hljs-attr">map-underscore-to-camel-case:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment"># 驼峰-下划线映射（默认开启）</span><br>    <span class="hljs-attr">cache-enabled:</span> <span class="hljs-literal">false</span>  <span class="hljs-comment"># 关闭二级缓存（按需开启）</span><br>  <span class="hljs-comment"># 4. MP全局配置</span><br>  <span class="hljs-attr">global-config:</span><br>    <span class="hljs-attr">db-config:</span><br>      <span class="hljs-attr">id-type:</span> <span class="hljs-string">assign_id</span>  <span class="hljs-comment"># 全局主键策略：雪花算法（默认）</span><br>      <span class="hljs-attr">update-strategy:</span> <span class="hljs-string">not_null</span>  <span class="hljs-comment"># 更新策略：只更新非null字段（默认）</span><br>      <span class="hljs-attr">table-prefix:</span> <span class="hljs-string">tb_</span>  <span class="hljs-comment"># 表名前缀（如PO类User对应tb_user表，可省略@TableName）</span><br></code></pre></td></tr></table></figure>
<h3 id="2-4-2-关键配置说明">2.4.2 关键配置说明</h3>
<table>
<thead>
<tr>
<th>配置项</th>
<th>作用</th>
<th>默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>type-aliases-package</code></td>
<td>PO 类别名扫描包，XML 中可简化类名引用</td>
<td>无（需手动指定）</td>
</tr>
<tr>
<td><code>mapper-locations</code></td>
<td>Mapper XML 文件路径，多模块用 classpath*:</td>
<td>classpath*:/mapper/**/*.xml</td>
</tr>
<tr>
<td><code>map-underscore-to-camel-case</code></td>
<td>字段驼峰（PO）与下划线（表）自动映射</td>
<td>true（建议保持开启）</td>
</tr>
<tr>
<td><code>id-type</code></td>
<td>全局主键策略</td>
<td>assign_id（雪花算法）</td>
</tr>
<tr>
<td><code>update-strategy</code></td>
<td>更新字段策略</td>
<td>not_null（只更非 null 字段）</td>
</tr>
<tr>
<td><code>table-prefix</code></td>
<td>表名前缀，统一添加避免重复注解</td>
<td>无</td>
</tr>
</tbody>
</table>
<h3 id="2-4-3-配置优先级">2.4.3 配置优先级</h3>
<p>局部注解 &gt; 全局配置，例如：全局配置<code>id-type: auto</code>，但某 PO 的主键注解为<code>@TableId(type = IdType.ASSIGN_ID)</code>，则该 PO 优先使用雪花算法。</p>
<h1>三、MyBatis-Plus 核心功能</h1>
<p>在基础 CRUD 操作之上，MyBatis-Plus 提供了三大核心能力来适配复杂业务场景：<strong>条件构造器</strong>解决动态筛选问题，<strong>自定义 SQL</strong> 适配特殊逻辑与多表场景，<strong>IService 接口</strong>封装 Service 层模板方法。三者结合可大幅提升开发效率，同时保留灵活性。</p>
<h2 id="3-1-条件构造器：动态-SQL-优雅实现">3.1 条件构造器：动态 SQL 优雅实现</h2>
<p>基础 CRUD 依赖 ID 作为条件，但实际业务中往往需要更复杂的筛选逻辑（如多字段组合查询、范围查询等）。MyBatis-Plus 提供的 <strong>条件构造器（Wrapper）</strong> 正是为解决这类问题而生，它能动态拼接 WHERE 条件，无需手动编写 SQL 语句。</p>
<h3 id="3-1-1-Wrapper-体系结构">3.1.1 Wrapper 体系结构</h3>
<p>Wrapper 是条件构造的核心抽象类，其设计采用了分层继承模式，不同子类对应不同场景的条件构造需求。</p>
<h4 id="继承关系">继承关系</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://a1.boltp.com/2025/09/19/68cd4933822a2.png" alt="image.png"></p>
<h4 id="核心类作用">核心类作用</h4>
<ul>
<li>
<p><strong>AbstractWrapper</strong>：提供所有 WHERE 条件的基础方法（如 <code>eq</code> 等于、<code>like</code> 模糊查询、<code>ge</code> 大于等于等）。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://a1.boltp.com/2025/09/19/68cd47764cb68.png" alt=""></p>
</li>
<li>
<p><strong>QueryWrapper</strong>：在 AbstractWrapper 基础上增加 <code>select()</code> 方法，可指定查询字段（避免 <code>SELECT *</code>）。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://a1.boltp.com/2025/09/19/68cd49937687b.png" alt=""></p>
</li>
<li>
<p><strong>UpdateWrapper</strong>：在 AbstractWrapper 基础上增加 <code>set()</code> 和 <code>setSql()</code> 方法，支持复杂更新（如基于字段现有值的计算）。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://a1.boltp.com/2025/09/19/68cd47c8470c1.png" alt=""></p>
</li>
<li>
<p><strong>LambdaXXXWrapper</strong>：通过 Lambda 表达式引用实体类方法（如 <code>User::getUsername</code>），避免直接写字符串字段名，减少拼写错误。</p>
</li>
</ul>
<h3 id="3-1-2-QueryWrapper：查询与简单更新-删除">3.1.2 QueryWrapper：查询与简单更新 / 删除</h3>
<p>QueryWrapper 是最常用的条件构造器，适用于 <strong>查询、删除、简单更新</strong> 场景，可通过链式调用拼接复杂 WHERE 条件。</p>
<h4 id="1-复杂查询示例">1. 复杂查询示例</h4>
<p><strong>需求</strong>：查询用户名中包含 “o”、余额大于等于 1000 元的用户，只返回 id、username、info、balance 字段。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testQueryWrapperSelect</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// 1. 构建查询条件：WHERE username LIKE &quot;%o%&quot; AND balance &gt;= 1000</span><br>    QueryWrapper&lt;User&gt; queryWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;&gt;();<br>    <span class="hljs-comment">// 指定查询字段（避免SELECT *）</span><br>    queryWrapper.select(<span class="hljs-string">&quot;id&quot;</span>, <span class="hljs-string">&quot;username&quot;</span>, <span class="hljs-string">&quot;info&quot;</span>, <span class="hljs-string">&quot;balance&quot;</span>)<br>                <span class="hljs-comment">// 模糊查询：username LIKE &quot;%o%&quot;</span><br>                .like(<span class="hljs-string">&quot;username&quot;</span>, <span class="hljs-string">&quot;o&quot;</span>)<br>                <span class="hljs-comment">// 大于等于：balance &gt;= 1000</span><br>                .ge(<span class="hljs-string">&quot;balance&quot;</span>, <span class="hljs-number">1000</span>);<br>    <br>    <span class="hljs-comment">// 2. 执行查询</span><br>    List&lt;User&gt; userList = userMapper.selectList(queryWrapper);<br>    userList.forEach(System.out::println);<br>&#125;<br></code></pre></td></tr></table></figure>
<p><strong>生成的 SQL</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> id,username,info,balance <br><span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> <br><span class="hljs-keyword">WHERE</span> username <span class="hljs-keyword">LIKE</span> ? <span class="hljs-keyword">AND</span> balance <span class="hljs-operator">&gt;=</span> ? <br><span class="hljs-comment">-- 参数：%o%（String）、1000（Integer）</span><br></code></pre></td></tr></table></figure>
<h4 id="2-基于条件的更新">2. 基于条件的更新</h4>
<p><strong>需求</strong>：将用户名为 “Jack” 的用户余额更新为 2000 元。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testQueryWrapperUpdate</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// 1. 准备更新数据（非null字段会被设置到SET中）</span><br>    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>    user.setBalance(<span class="hljs-number">2000</span>);<br>    <br>    <span class="hljs-comment">// 2. 构建条件：WHERE username = &quot;Jack&quot;</span><br>    QueryWrapper&lt;User&gt; queryWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;User&gt;()<br>        .eq(<span class="hljs-string">&quot;username&quot;</span>, <span class="hljs-string">&quot;Jack&quot;</span>); <span class="hljs-comment">// 等于条件</span><br>    <br>    <span class="hljs-comment">// 3. 执行更新（WHERE条件由queryWrapper决定，SET字段由user非null值决定）</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">rows</span> <span class="hljs-operator">=</span> userMapper.update(user, queryWrapper);<br>    System.out.println(<span class="hljs-string">&quot;更新成功：&quot;</span> + (rows &gt; <span class="hljs-number">0</span>));<br>&#125;<br></code></pre></td></tr></table></figure>
<p><strong>生成的 SQL</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">user</span> <br><span class="hljs-keyword">SET</span> balance<span class="hljs-operator">=</span>? <br><span class="hljs-keyword">WHERE</span> username <span class="hljs-operator">=</span> ? <br><span class="hljs-comment">-- 参数：2000（Integer）、Jack（String）</span><br></code></pre></td></tr></table></figure>
<h4 id="3-基于条件的删除">3. 基于条件的删除</h4>
<p><strong>需求</strong>：删除状态为 “冻结”（status=2）且余额为 0 的用户。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testQueryWrapperDelete</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// 1. 构建条件：WHERE status = 2 AND balance = 0</span><br>    QueryWrapper&lt;User&gt; queryWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;&gt;()<br>        .eq(<span class="hljs-string">&quot;status&quot;</span>, <span class="hljs-number">2</span>)<br>        .eq(<span class="hljs-string">&quot;balance&quot;</span>, <span class="hljs-number">0</span>);<br>    <br>    <span class="hljs-comment">// 2. 执行删除</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">rows</span> <span class="hljs-operator">=</span> userMapper.delete(queryWrapper);<br>    System.out.println(<span class="hljs-string">&quot;删除成功：&quot;</span> + (rows &gt; <span class="hljs-number">0</span>));<br>&#125;<br></code></pre></td></tr></table></figure>
<p><strong>生成的 SQL</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> <br><span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> ? <span class="hljs-keyword">AND</span> balance <span class="hljs-operator">=</span> ? <br><span class="hljs-comment">-- 参数：2（Integer）、0（Integer）</span><br></code></pre></td></tr></table></figure>
<h3 id="3-1-3-UpdateWrapper：复杂更新场景">3.1.3 UpdateWrapper：复杂更新场景</h3>
<p>当更新操作需要 <strong>基于字段现有值计算</strong>（如 <code>balance = balance - 200</code>）时，QueryWrapper 无法满足需求，需使用 UpdateWrapper 的 <code>setSql()</code> 方法直接编写 SET 语句片段。</p>
<h4 id="1-基于字段现有值的更新">1. 基于字段现有值的更新</h4>
<p><strong>需求</strong>：给 id 为 1、2、4 的用户余额扣除 200 元（<code>balance = balance - 200</code>）。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testUpdateWrapper</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// 1. 准备条件：WHERE id IN (1, 2, 4)</span><br>    List&lt;Long&gt; ids = List.of(<span class="hljs-number">1L</span>, <span class="hljs-number">2L</span>, <span class="hljs-number">4L</span>);<br>    <br>    <span class="hljs-comment">// 2. 构建更新条件与SET语句</span><br>    UpdateWrapper&lt;User&gt; updateWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UpdateWrapper</span>&lt;User&gt;()<br>        <span class="hljs-comment">// 直接编写SET片段：balance = balance - 200</span><br>        .setSql(<span class="hljs-string">&quot;balance = balance - 200&quot;</span>)<br>        <span class="hljs-comment">// WHERE条件：id IN (1,2,4)</span><br>        .in(<span class="hljs-string">&quot;id&quot;</span>, ids);<br>    <br>    <span class="hljs-comment">// 3. 执行更新（无需传递User对象，SET语句由updateWrapper定义）</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">rows</span> <span class="hljs-operator">=</span> userMapper.update(<span class="hljs-literal">null</span>, updateWrapper);<br>    System.out.println(<span class="hljs-string">&quot;更新成功：&quot;</span> + (rows &gt; <span class="hljs-number">0</span>));<br>&#125;<br></code></pre></td></tr></table></figure>
<p><strong>生成的 SQL</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">user</span> <br><span class="hljs-keyword">SET</span> balance <span class="hljs-operator">=</span> balance <span class="hljs-operator">-</span> <span class="hljs-number">200</span> <br><span class="hljs-keyword">WHERE</span> id <span class="hljs-keyword">IN</span> (?, ?, ?) <br><span class="hljs-comment">-- 参数：1（Long）、2（Long）、4（Long）</span><br></code></pre></td></tr></table></figure>
<h4 id="2-组合更新（SET-多字段）">2. 组合更新（SET 多字段）</h4>
<p><strong>需求</strong>：给 “Jack” 的余额增加 500 元，同时将状态改为 “正常”（status=1）。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testUpdateWrapperComplex</span><span class="hljs-params">()</span> &#123;<br>    UpdateWrapper&lt;User&gt; updateWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UpdateWrapper</span>&lt;User&gt;()<br>        <span class="hljs-comment">// SET balance = balance + 500, status = 1</span><br>        .setSql(<span class="hljs-string">&quot;balance = balance + 500&quot;</span>)<br>        .set(<span class="hljs-string">&quot;status&quot;</span>, <span class="hljs-number">1</span>) <span class="hljs-comment">// 简单赋值也可使用set()</span><br>        <span class="hljs-comment">// WHERE username = &quot;Jack&quot;</span><br>        .eq(<span class="hljs-string">&quot;username&quot;</span>, <span class="hljs-string">&quot;Jack&quot;</span>);<br>    <br>    <span class="hljs-type">int</span> <span class="hljs-variable">rows</span> <span class="hljs-operator">=</span> userMapper.update(<span class="hljs-literal">null</span>, updateWrapper);<br>    System.out.println(<span class="hljs-string">&quot;更新成功：&quot;</span> + (rows &gt; <span class="hljs-number">0</span>));<br>&#125;<br></code></pre></td></tr></table></figure>
<p><strong>生成的 SQL</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">user</span> <br><span class="hljs-keyword">SET</span> balance <span class="hljs-operator">=</span> balance <span class="hljs-operator">+</span> <span class="hljs-number">500</span>, status <span class="hljs-operator">=</span> ? <br><span class="hljs-keyword">WHERE</span> username <span class="hljs-operator">=</span> ? <br><span class="hljs-comment">-- 参数：1（Integer）、Jack（String）</span><br></code></pre></td></tr></table></figure>
<h3 id="3-1-4-Lambda-条件构造器：避免硬编码">3.1.4 Lambda 条件构造器：避免硬编码</h3>
<p>普通 Wrapper 在构造条件时需要手动输入字段名（如 <code>&quot;username&quot;</code>），存在 <strong>字符串硬编码</strong> 问题（拼写错误不会在编译期报错）。Lambda 条件构造器通过 <strong>方法引用</strong> 解决这一问题，让字段名与实体类属性强关联。</p>
<h4 id="1-LambdaQueryWrapper-示例">1. LambdaQueryWrapper 示例</h4>
<p><strong>需求</strong>：查询年龄大于 20 岁（从 info 字段的 JSON 中解析）、状态为正常（status=1）的用户。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testLambdaQueryWrapper</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// 1. 构建Lambda查询条件（使用User::getXxx方法引用）</span><br>    LambdaQueryWrapper&lt;User&gt; lambdaQueryWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>    <span class="hljs-comment">// WHERE status = 1 AND username LIKE &quot;%o%&quot;</span><br>    lambdaQueryWrapper.eq(User::getStatus, <span class="hljs-number">1</span>)<br>                      .like(User::getUsername, <span class="hljs-string">&quot;o&quot;</span>);<br>    <br>    <span class="hljs-comment">// 2. 执行查询</span><br>    List&lt;User&gt; userList = userMapper.selectList(lambdaQueryWrapper);<br>    userList.forEach(System.out::println);<br>&#125;<br></code></pre></td></tr></table></figure>
<p><strong>优势</strong>：若误写为 <code>User::getUsernam</code>（少个 e），编译期会直接报错，避免运行时因字段名错误导致的 SQL 异常。</p>
<h4 id="2-LambdaUpdateWrapper-示例">2. LambdaUpdateWrapper 示例</h4>
<p><strong>需求</strong>：将 id 为 3 的用户余额翻倍（<code>balance = balance * 2</code>），并更新修改时间。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testLambdaUpdateWrapper</span><span class="hljs-params">()</span> &#123;<br>    LambdaUpdateWrapper&lt;User&gt; lambdaUpdateWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaUpdateWrapper</span>&lt;&gt;();<br>    <span class="hljs-comment">// SET balance = balance * 2, update_time = NOW()</span><br>    lambdaUpdateWrapper.setSql(<span class="hljs-string">&quot;balance = balance * 2&quot;</span>)<br>                       .set(User::getUpdateTime, LocalDateTime.now())<br>                       <span class="hljs-comment">// WHERE id = 3</span><br>                       .eq(User::getId, <span class="hljs-number">3L</span>);<br>    <br>    <span class="hljs-type">int</span> <span class="hljs-variable">rows</span> <span class="hljs-operator">=</span> userMapper.update(<span class="hljs-literal">null</span>, lambdaUpdateWrapper);<br>    System.out.println(<span class="hljs-string">&quot;更新成功：&quot;</span> + (rows &gt; <span class="hljs-number">0</span>));<br>&#125;<br></code></pre></td></tr></table></figure>
<p><strong>生成的 SQL</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">user</span> <br><span class="hljs-keyword">SET</span> balance <span class="hljs-operator">=</span> balance <span class="hljs-operator">*</span> <span class="hljs-number">2</span>, update_time <span class="hljs-operator">=</span> ? <br><span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> ? <br><span class="hljs-comment">-- 参数：2024-11-13T15:30:00（LocalDateTime）、3（Long）</span><br></code></pre></td></tr></table></figure>
<h3 id="3-1-5-常用条件方法速查表">3.1.5 常用条件方法速查表</h3>
<p>AbstractWrapper 提供了丰富的条件方法，覆盖 SQL 中所有常见的 WHERE 子句语法，以下是高频使用的方法：</p>
<table>
<thead>
<tr>
<th>方法名</th>
<th>作用</th>
<th>示例</th>
<th>对应的 SQL 片段</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>eq</code></td>
<td>等于（=）</td>
<td><code>eq(&quot;name&quot;, &quot;Jack&quot;)</code></td>
<td><code>name = 'Jack'</code></td>
</tr>
<tr>
<td><code>ne</code></td>
<td>不等于（≠）</td>
<td><code>ne(&quot;status&quot;, 0)</code></td>
<td><code>status != 0</code></td>
</tr>
<tr>
<td><code>like</code></td>
<td>模糊查询（% 值 %）</td>
<td><code>like(&quot;username&quot;, &quot;o&quot;)</code></td>
<td><code>username LIKE '%o%'</code></td>
</tr>
<tr>
<td><code>likeLeft</code></td>
<td>左模糊（% 值）</td>
<td><code>likeLeft(&quot;phone&quot;, &quot;139&quot;)</code></td>
<td><code>phone LIKE '%139'</code></td>
</tr>
<tr>
<td><code>likeRight</code></td>
<td>右模糊（值 %）</td>
<td><code>likeRight(&quot;email&quot;, &quot;test&quot;)</code></td>
<td><code>email LIKE 'test%'</code></td>
</tr>
<tr>
<td><code>gt</code></td>
<td>大于（&gt;）</td>
<td><code>gt(&quot;balance&quot;, 1000)</code></td>
<td><code>balance &gt; 1000</code></td>
</tr>
<tr>
<td><code>ge</code></td>
<td>大于等于（≥）</td>
<td><code>ge(&quot;age&quot;, 18)</code></td>
<td><code>age &gt;= 18</code></td>
</tr>
<tr>
<td><code>lt</code></td>
<td>小于（&lt;）</td>
<td><code>lt(&quot;score&quot;, 60)</code></td>
<td><code>score &lt; 60</code></td>
</tr>
<tr>
<td><code>le</code></td>
<td>小于等于（≤）</td>
<td><code>le(&quot;level&quot;, 3)</code></td>
<td><code>level &lt;= 3</code></td>
</tr>
<tr>
<td><code>in</code></td>
<td>包含在集合中</td>
<td><code>in(&quot;id&quot;, 1, 2, 3)</code></td>
<td><code>id IN (1,2,3)</code></td>
</tr>
<tr>
<td><code>notIn</code></td>
<td>不包含在集合中</td>
<td><code>notIn(&quot;status&quot;, 0, 2)</code></td>
<td><code>status NOT IN (0,2)</code></td>
</tr>
<tr>
<td><code>between</code></td>
<td>在范围内（闭区间）</td>
<td><code>between(&quot;create_time&quot;, &quot;2023-01-01&quot;, &quot;2023-12-31&quot;)</code></td>
<td><code>create_time BETWEEN '2023-01-01' AND '2023-12-31'</code></td>
</tr>
<tr>
<td><code>isNull</code></td>
<td>字段为 NULL</td>
<td><code>isNull(&quot;email&quot;)</code></td>
<td><code>email IS NULL</code></td>
</tr>
<tr>
<td><code>isNotNull</code></td>
<td>字段不为 NULL</td>
<td><code>isNotNull(&quot;phone&quot;)</code></td>
<td><code>phone IS NOT NULL</code></td>
</tr>
<tr>
<td><code>and</code></td>
<td>拼接 AND 条件（嵌套）</td>
<td><code>and(w -&gt; w.gt(&quot;balance&quot;, 1000).lt(&quot;balance&quot;, 5000))</code></td>
<td><code>AND (balance &gt; 1000 AND balance &lt; 5000)</code></td>
</tr>
<tr>
<td><code>or</code></td>
<td>拼接 OR 条件（嵌套）</td>
<td><code>or(w -&gt; w.eq(&quot;status&quot;, 1).or().eq(&quot;status&quot;, 3))</code></td>
<td><code>OR (status = 1 OR status = 3)</code></td>
</tr>
</tbody>
</table>
<h3 id="3-1-6-条件构造器使用总结">3.1.6 条件构造器使用总结</h3>
<ol>
<li><strong>场景选择</strong>：
<ul>
<li>简单查询 / 更新 / 删除：优先使用 <code>LambdaQueryWrapper</code>（避免硬编码）。</li>
<li>复杂更新（如基于字段计算）：使用 <code>LambdaUpdateWrapper</code>。</li>
<li>特殊场景（如多表联查需手动写 SQL）：可混合使用 Wrapper 和 XML 映射。</li>
</ul>
</li>
<li><strong>最佳实践</strong>：
<ul>
<li>始终优先使用 Lambda 版本（<code>LambdaQueryWrapper</code>/<code>LambdaUpdateWrapper</code>），减少字段名拼写错误。</li>
<li>复杂条件使用 <code>and()</code>/<code>or()</code> 嵌套，避免长链式调用导致的可读性问题。</li>
<li>多表查询时，Wrapper 仅负责单表条件，关联条件仍需在 XML 中编写。</li>
</ul>
</li>
</ol>
<p>通过条件构造器，MyBatis-Plus 实现了动态 SQL 的优雅处理，既保留了 MyBatis 的灵活性，又简化了重复代码，大幅提升了复杂查询场景的开发效率。</p>
<h2 id="3-2-自定义-SQL-与-IService-接口：分层开发效率提升">3.2 自定义 SQL 与 IService 接口：分层开发效率提升</h2>
<p>在基础 CRUD 和条件构造的基础上，MyBatis-Plus 进一步通过 <strong>自定义 SQL</strong> 解决复杂场景（如多表联查、特殊更新），通过 <strong>IService 接口</strong> 封装 Service 层模板方法，实现 “分层开发” 与 “效率提升” 的结合。</p>
<h3 id="3-2-1-自定义-SQL：适配特殊逻辑与多表场景">3.2.1 自定义 SQL：适配特殊逻辑与多表场景</h3>
<p>MyBatis-Plus 虽能覆盖大部分单表场景，但面对 <strong>特殊 SQL 逻辑</strong>（如字段自增 / 自减）或 <strong>多表联查</strong> 时，需结合 “Wrapper 生成条件 + 自定义 SQL 片段” 的方式，既保留动态条件的灵活性，又将 SQL 维护在持久层。</p>
<h4 id="1-核心场景：避免-SQL-硬编码到业务层">1. 核心场景：避免 SQL 硬编码到业务层</h4>
<h5 id="问题引出">问题引出</h5>
<p>使用 <code>UpdateWrapper</code> 时，若直接在 Service 层编写 <code>setSql(&quot;balance = balance - 200&quot;)</code>，会导致 <strong>SQL 片段散落在业务层</strong>，违背 “持久层维护 SQL” 的开发规范。此外，复杂条件（如动态 <code>IN</code> 语句）若纯手写 XML，需编写繁琐的 <code>&lt;foreach&gt;</code> 标签，易出错。</p>
<h5 id="解决方案：Wrapper-自定义-SQL-片段">解决方案：Wrapper + 自定义 SQL 片段</h5>
<p>MyBatis-Plus 提供 <code>ew.customSqlSegment</code> 变量，可直接引用 Wrapper 生成的 WHERE 条件片段，实现 “条件由 MP 构建，SQL 核心逻辑由自定义实现”。</p>
<h5 id="实现步骤">实现步骤</h5>
<ol>
<li><strong>Service 层构建条件</strong>：用 Wrapper 定义查询条件（避免业务层写 SQL）；</li>
<li><strong>Mapper 层声明方法</strong>：用 <code>@Param(&quot;ew&quot;)</code> 接收 Wrapper（参数名固定为<code>ew</code>，可用<code>Constants.WRAPPER</code>常量替代）；</li>
<li><strong>编写自定义 SQL</strong>：通过 <code>$&#123;ew.customSqlSegment&#125;</code> 嵌入 MP 生成的条件。</li>
</ol>
<h4 id="代码示例：字段自减更新">代码示例：字段自减更新</h4>
<p><strong>需求</strong>：批量扣减指定 ID 用户的余额（<code>balance = balance - #&#123;amount&#125;</code>），条件由 MP 构建。</p>
<h5 id="1-Service-层：构建条件">1. Service 层：构建条件</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ServiceImpl</span>&lt;UserMapper, User&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IUserService</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deductBalanceBatch</span><span class="hljs-params">(List&lt;Long&gt; ids, <span class="hljs-type">int</span> amount)</span> &#123;<br>        <span class="hljs-comment">// 1. 用Lambda构建条件：WHERE id IN (ids)</span><br>        LambdaQueryWrapper&lt;User&gt; wrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;User&gt;()<br>                .in(User::getId, ids);<br>        <span class="hljs-comment">// 2. 调用自定义SQL方法（条件+参数传入Mapper）</span><br>        baseMapper.updateBalanceByIds(wrapper, amount);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h5 id="2-Mapper-层：自定义-SQL-片段">2. Mapper 层：自定义 SQL 片段</h5>
<p>支持 <strong>注解式 SQL</strong> 或 <strong>XML 式 SQL</strong>，核心是引用 <code>ew.customSqlSegment</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.toolkit.Constants;<br><span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Param;<br><span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Update;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapper</span>&lt;User&gt; &#123;<br>    <span class="hljs-comment">// 注解式SQL：$&#123;ew.customSqlSegment&#125; 嵌入WHERE条件</span><br>    <span class="hljs-meta">@Update(&quot;UPDATE user SET balance = balance - #&#123;amount&#125; $&#123;ew.customSqlSegment&#125;&quot;)</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateBalanceByIds</span><span class="hljs-params">(</span><br><span class="hljs-params">            <span class="hljs-meta">@Param(Constants.WRAPPER)</span> LambdaQueryWrapper&lt;User&gt; wrapper,  // 固定参数名ew</span><br><span class="hljs-params">            <span class="hljs-meta">@Param(&quot;amount&quot;)</span> <span class="hljs-type">int</span> amount</span><br><span class="hljs-params">    )</span>;<br><br>    <span class="hljs-comment">// 若用XML式SQL，在userMapper.xml中编写：</span><br>    <span class="hljs-comment">// &lt;update id=&quot;updateBalanceByIds&quot;&gt;</span><br>    <span class="hljs-comment">//     UPDATE user SET balance = balance - #&#123;amount&#125; $&#123;ew.customSqlSegment&#125;</span><br>    <span class="hljs-comment">// &lt;/update&gt;</span><br>&#125;<br></code></pre></td></tr></table></figure>
<h5 id="3-生成的-SQL">3. 生成的 SQL</h5>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">SET</span> balance <span class="hljs-operator">=</span> balance <span class="hljs-operator">-</span> <span class="hljs-number">200</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-keyword">IN</span> (?, ?, ?)<br><span class="hljs-comment">-- 参数：200（amount）、1（id）、2（id）、4（id）</span><br></code></pre></td></tr></table></figure>
<h4 id="2-进阶场景：多表联查">2. 进阶场景：多表联查</h4>
<p>MyBatis-Plus 本身不支持多表联查，但可通过 “自定义关联逻辑 + Wrapper 条件” 实现 ——<strong>关联部分手写 SQL，筛选条件由 MP 构建</strong>，大幅简化动态条件的编写。</p>
<p><strong>需求</strong>：查询 “收货地址在北京” 且 “用户 ID 在 1、2、4 中” 的用户信息。</p>
<h5 id="1-Service-层：构建多表条件">1. Service 层：构建多表条件</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">queryUserWithAddr</span><span class="hljs-params">(String city, List&lt;Long&gt; userIds)</span> &#123;<br>    <span class="hljs-comment">// 构建条件：WHERE u.id IN (1,2,4) AND a.city = &#x27;北京&#x27;</span><br>    QueryWrapper&lt;User&gt; wrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;User&gt;()<br>            .in(<span class="hljs-string">&quot;u.id&quot;</span>, userIds)  <span class="hljs-comment">// 表别名需与SQL一致</span><br>            .eq(<span class="hljs-string">&quot;a.city&quot;</span>, city);<br>    <span class="hljs-keyword">return</span> baseMapper.queryUserByAddr(wrapper);<br>&#125;<br></code></pre></td></tr></table></figure>
<h5 id="2-Mapper-层：自定义多表-SQL">2. Mapper 层：自定义多表 SQL</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Param;<br><span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Select;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapper</span>&lt;User&gt; &#123;<br>    <span class="hljs-comment">// 关联查询：SELECT + JOIN 手写，WHERE条件用MP生成</span><br>    <span class="hljs-meta">@Select(&quot;SELECT u.* FROM user u &quot; +</span><br><span class="hljs-meta">            &quot;INNER JOIN address a ON u.id = a.user_id &quot; +</span><br><span class="hljs-meta">            &quot;$&#123;ew.customSqlSegment&#125;&quot;)</span><br>    List&lt;User&gt; <span class="hljs-title function_">queryUserByAddr</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;ew&quot;)</span> QueryWrapper&lt;User&gt; wrapper)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h5 id="3-生成的-SQL-2">3. 生成的 SQL</h5>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> u.<span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> u <br><span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> address a <span class="hljs-keyword">ON</span> u.id <span class="hljs-operator">=</span> a.user_id <br><span class="hljs-keyword">WHERE</span> u.id <span class="hljs-keyword">IN</span> (?, ?, ?) <span class="hljs-keyword">AND</span> a.city <span class="hljs-operator">=</span> ?<br><span class="hljs-comment">-- 参数：1（userIds）、2（userIds）、4（userIds）、北京（city）</span><br></code></pre></td></tr></table></figure>
<h4 id="3-自定义-SQL-适用场景总结">3. 自定义 SQL 适用场景总结</h4>
<table>
<thead>
<tr>
<th>场景</th>
<th>解决方案</th>
<th>优势</th>
</tr>
</thead>
<tbody>
<tr>
<td>特殊更新（字段自增 / 自减）</td>
<td>Wrapper 构建 WHERE + 自定义 SQL 写 SET</td>
<td>避免 SQL 散落在 Service 层</td>
</tr>
<tr>
<td>复杂动态条件（多字段筛选）</td>
<td>Wrapper 生成条件 + 自定义 SQL 写核心逻辑</td>
<td>替代繁琐的<code>&lt;if&gt;</code>/<code>&lt;foreach&gt;</code>标签</td>
</tr>
<tr>
<td>多表联查</td>
<td>自定义 JOIN + Wrapper 生成筛选条件</td>
<td>保留 MP 动态条件优势，适配多表场景</td>
</tr>
</tbody>
</table>
<h3 id="3-2-2-IService-接口：Service-层模板方法封装">3.2.2 IService 接口：Service 层模板方法封装</h3>
<p>MyBatis-Plus 不仅在 DAO 层提供 <code>BaseMapper</code>，还在 Service 层封装了 <strong>IService 接口及默认实现</strong>，涵盖批量操作、条件查询、分页等高频模板方法，避免重复编写 Service 层代码。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://a1.boltp.com/2025/09/19/68cd43aaaa674.png" alt=""></p>
<h4 id="1-IService-核心设计">1. IService 核心设计</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://a1.boltp.com/2025/09/19/68cd4437963c2.png" alt=""></p>
<ul>
<li><strong>顶层接口</strong>：<code>IService&lt;T&gt;</code>，定义 Service 层通用方法；</li>
<li><strong>默认实现</strong>：<code>ServiceImpl&lt;M extends BaseMapper&lt;T&gt;, T&gt;</code>，已实现 <code>IService</code> 所有方法，内部依赖 <code>BaseMapper</code>；</li>
<li><strong>使用方式</strong>：自定义 Service 接口继承 <code>IService</code>，实现类继承 <code>ServiceImpl</code>，即可复用所有模板方法。</li>
</ul>
<h4 id="2-核心方法分类（高频）">2. 核心方法分类（高频）</h4>
<p><code>IService</code> 方法按功能可分为 7 大类，覆盖绝大多数 Service 层场景：</p>
<table>
<thead>
<tr>
<th>类别</th>
<th>核心方法</th>
<th>作用描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>新增</strong></td>
<td><code>save(T entity)</code></td>
<td>新增单个实体</td>
</tr>
<tr>
<td></td>
<td><code>saveBatch(Collection&lt;T&gt; list)</code></td>
<td>批量新增（默认批次 1000 条）</td>
</tr>
<tr>
<td></td>
<td><code>saveOrUpdate(T entity)</code></td>
<td>新增或更新（根据 ID 判断）</td>
</tr>
<tr>
<td><strong>删除</strong></td>
<td><code>removeById(Serializable id)</code></td>
<td>根据 ID 删除</td>
</tr>
<tr>
<td></td>
<td><code>removeByIds(Collection&lt;?&gt; ids)</code></td>
<td>批量删除</td>
</tr>
<tr>
<td></td>
<td><code>remove(Wrapper&lt;T&gt; wrapper)</code></td>
<td>根据条件删除</td>
</tr>
<tr>
<td><strong>更新</strong></td>
<td><code>updateById(T entity)</code></td>
<td>根据 ID 更新（只更非 null 字段）</td>
</tr>
<tr>
<td></td>
<td><code>update(T entity, Wrapper&lt;T&gt; wrapper)</code></td>
<td>根据条件更新指定字段</td>
</tr>
<tr>
<td></td>
<td><code>updateBatchById(Collection&lt;T&gt; list)</code></td>
<td>批量更新</td>
</tr>
<tr>
<td><strong>单条查询</strong></td>
<td><code>getById(Serializable id)</code></td>
<td>根据 ID 查询</td>
</tr>
<tr>
<td></td>
<td><code>getOne(Wrapper&lt;T&gt; wrapper)</code></td>
<td>根据条件查询单条（默认抛异常 if 多条）</td>
</tr>
<tr>
<td><strong>列表查询</strong></td>
<td><code>list()</code></td>
<td>查询所有</td>
</tr>
<tr>
<td></td>
<td><code>listByIds(Collection&lt;?&gt; ids)</code></td>
<td>批量查询</td>
</tr>
<tr>
<td></td>
<td><code>list(Wrapper&lt;T&gt; wrapper)</code></td>
<td>根据条件查询列表</td>
</tr>
<tr>
<td><strong>计数</strong></td>
<td><code>count()</code></td>
<td>统计总条数</td>
</tr>
<tr>
<td></td>
<td><code>count(Wrapper&lt;T&gt; wrapper)</code></td>
<td>根据条件统计</td>
</tr>
<tr>
<td><strong>分页</strong></td>
<td><code>page(IPage&lt;T&gt; page, Wrapper&lt;T&gt; wrapper)</code></td>
<td>条件分页查询</td>
</tr>
</tbody>
</table>
<h4 id="3-基本使用流程">3. 基本使用流程</h4>
<h5 id="步骤-1：定义自定义-Service-接口">步骤 1：定义自定义 Service 接口</h5>
<p>继承 <code>IService&lt;T&gt;</code>，泛型为 PO 实体类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;<br><span class="hljs-keyword">import</span> com.itheima.mp.domain.po.User;<br><br><span class="hljs-comment">// 自定义接口：继承IService，可添加业务方法</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IUserService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">IService</span>&lt;User&gt; &#123;<br>    <span class="hljs-comment">// 示例：自定义业务方法（扣减余额）</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">deductBalanceById</span><span class="hljs-params">(Long id, Integer money)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h5 id="步骤-2：实现-Service-类">步骤 2：实现 Service 类</h5>
<p>继承 <code>ServiceImpl&lt;M, T&gt;</code>（M 为 Mapper 接口，T 为 PO），实现自定义接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;<br><span class="hljs-keyword">import</span> com.itheima.mp.domain.po.User;<br><span class="hljs-keyword">import</span> com.itheima.mp.mapper.UserMapper;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ServiceImpl</span>&lt;UserMapper, User&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IUserService</span> &#123;<br>    <span class="hljs-comment">// 无需手动实现IService的方法，ServiceImpl已全部封装</span><br>    <span class="hljs-comment">// 可直接使用baseMapper调用自定义SQL，或使用IService的模板方法</span><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deductBalanceById</span><span class="hljs-params">(Long id, Integer money)</span> &#123;<br>        <span class="hljs-comment">// 1. 复用IService的查询方法</span><br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> getById(id);<br>        <span class="hljs-comment">// 2. 业务校验</span><br>        <span class="hljs-keyword">if</span> (user == <span class="hljs-literal">null</span> || user.getStatus() == <span class="hljs-number">2</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;用户状态异常&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (user.getBalance() &lt; money) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;余额不足&quot;</span>);<br>        &#125;<br>        <span class="hljs-comment">// 3. 调用自定义SQL（通过baseMapper）</span><br>        baseMapper.deductBalance(id, money);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h5 id="步骤-3：Controller-层调用">步骤 3：Controller 层调用</h5>
<p>直接注入自定义 Service，复用模板方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/users&quot;)</span><br><span class="hljs-meta">@RequiredArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> IUserService userService;<br><br>    <span class="hljs-comment">// 新增用户：复用IService的save方法</span><br>    <span class="hljs-meta">@PostMapping</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> UserFormDTO dto)</span> &#123;<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> BeanUtil.copyProperties(dto, User.class);<br>        userService.save(user);<br>    &#125;<br><br>    <span class="hljs-comment">// 批量查询：复用IService的listByIds方法</span><br>    <span class="hljs-meta">@GetMapping</span><br>    <span class="hljs-keyword">public</span> List&lt;UserVO&gt; <span class="hljs-title function_">listByIds</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> List&lt;Long&gt; ids)</span> &#123;<br>        List&lt;User&gt; users = userService.listByIds(ids);<br>        <span class="hljs-keyword">return</span> BeanUtil.copyToList(users, UserVO.class);<br>    &#125;<br><br>    <span class="hljs-comment">// 自定义业务：扣减余额</span><br>    <span class="hljs-meta">@PutMapping(&quot;/&#123;id&#125;/deduction/&#123;money&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deduct</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id, <span class="hljs-meta">@PathVariable</span> Integer money)</span> &#123;<br>        userService.deductBalanceById(id, money);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="4-进阶：LambdaQuery-与-LambdaUpdate（高效！）">4. 进阶：LambdaQuery 与 LambdaUpdate（高效！）</h4>
<p><code>IService</code> 提供 <code>lambdaQuery()</code> 和 <code>lambdaUpdate()</code> 方法（究极好用！！！），可直接链式构建 Lambda 条件，无需手动创建 <code>LambdaQueryWrapper</code>，进一步简化代码。</p>
<h5 id="场景-1：动态条件查询">场景 1：动态条件查询</h5>
<p><strong>需求</strong>：根据 “用户名关键字、状态、余额范围” 动态查询用户（条件可为空）。</p>
<h5 id="1-定义查询-DTO">1. 定义查询 DTO</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserQueryDTO</span> &#123;<br>    <span class="hljs-keyword">private</span> String name;      <span class="hljs-comment">// 用户名关键字（可为空）</span><br>    <span class="hljs-keyword">private</span> Integer status;   <span class="hljs-comment">// 状态（可为空）</span><br>    <span class="hljs-keyword">private</span> Integer minBalance; <span class="hljs-comment">// 最小余额（可为空）</span><br>    <span class="hljs-keyword">private</span> Integer maxBalance; <span class="hljs-comment">// 最大余额（可为空）</span><br>&#125;<br></code></pre></td></tr></table></figure>
<h5 id="2-Service-层实现">2. Service 层实现</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">queryByCondition</span><span class="hljs-params">(UserQueryDTO dto)</span> &#123;<br>    <span class="hljs-comment">// lambdaQuery()：直接获取Lambda查询器，支持条件判断</span><br>    <span class="hljs-keyword">return</span> lambdaQuery()<br>            .like(dto.getName() != <span class="hljs-literal">null</span>, User::getUsername, dto.getName())  <span class="hljs-comment">// 非空才加条件</span><br>            .eq(dto.getStatus() != <span class="hljs-literal">null</span>, User::getStatus, dto.getStatus())<br>            .ge(dto.getMinBalance() != <span class="hljs-literal">null</span>, User::getBalance, dto.getMinBalance())<br>            .le(dto.getMaxBalance() != <span class="hljs-literal">null</span>, User::getBalance, dto.getMaxBalance())<br>            .list(); <span class="hljs-comment">// 结尾指定返回类型（list/one/count）</span><br>&#125;<br></code></pre></td></tr></table></figure>
<h5 id="场景-2：动态更新">场景 2：动态更新</h5>
<p><strong>需求</strong>：扣减余额，若扣减后余额为 0，则冻结用户（status=2）。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-meta">@Transactional</span> <span class="hljs-comment">// 事务保证</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deductBalanceWithFreeze</span><span class="hljs-params">(Long id, Integer money)</span> &#123;<br>    <span class="hljs-comment">// 1. 查询用户</span><br>    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> getById(id);<br>    <span class="hljs-comment">// 2. 校验</span><br>    <span class="hljs-keyword">if</span> (user == <span class="hljs-literal">null</span> || user.getStatus() == <span class="hljs-number">2</span>) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;用户异常&quot;</span>);<br>    &#125;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">remain</span> <span class="hljs-operator">=</span> user.getBalance() - money;<br>    <span class="hljs-keyword">if</span> (remain &lt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;余额不足&quot;</span>);<br>    &#125;<br>    <span class="hljs-comment">// 3. 动态更新：余额必更，状态按需更新</span><br>    lambdaUpdate()<br>            .set(User::getBalance, remain)<br>            .set(remain == <span class="hljs-number">0</span>, User::getStatus, <span class="hljs-number">2</span>)  <span class="hljs-comment">// 余额为0则冻结</span><br>            .eq(User::getId, id)<br>            .update(); <span class="hljs-comment">// 执行更新</span><br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="5-性能优化：批量新增与批处理">5. 性能优化：批量新增与批处理</h4>
<p><code>IService</code> 的 <code>saveBatch()</code> 方法默认采用 “预编译批处理”，但需配合 MySQL 驱动参数才能达到最优性能。</p>
<h5 id="三种批量插入方案对比">三种批量插入方案对比</h5>
<table>
<thead>
<tr>
<th>方案</th>
<th>实现方式</th>
<th>耗时（10 万条数据）</th>
<th>原理</th>
</tr>
</thead>
<tbody>
<tr>
<td>普通 for 循环逐条插入</td>
<td><code>for (User u : list) &#123; save(u); &#125;</code></td>
<td>~550 秒</td>
<td>每条数据 1 次网络请求，效率极低</td>
</tr>
<tr>
<td>MP 批量插入（默认）</td>
<td><code>saveBatch(list, 1000)</code></td>
<td>~28 秒</td>
<td>每 1000 条 1 次网络请求，仍逐条执行 SQL</td>
</tr>
<tr>
<td>MP+MySQL 批处理参数</td>
<td><code>saveBatch(list, 1000) + rewriteBatchedStatements=true</code></td>
<td>~6 秒</td>
<td>驱动重写 SQL 为批量插入，1 次请求 1 条 SQL</td>
</tr>
</tbody>
</table>
<h5 id="关键配置：开启-MySQL-批处理">关键配置：开启 MySQL 批处理</h5>
<p>在 JDBC URL 中添加 <code>rewriteBatchedStatements=true</code>（MySQL 驱动 3.1.13 + 支持）：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://127.0.0.1:3306/mp?useUnicode=true&amp;serverTimezone=Asia/Shanghai&amp;rewriteBatchedStatements=true</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span><br></code></pre></td></tr></table></figure>
<h5 id="注意事项">注意事项</h5>
<ul>
<li>批次大小建议 1000-5000 条：避免单次请求数据量过大导致超时；</li>
<li>内存优化：分批次构建数据列表，避免一次性创建 10 万条对象占用过多内存。</li>
</ul>
<h4 id="6-IService-使用总结">6. IService 使用总结</h4>
<ol>
<li><strong>核心价值</strong>：封装 Service 层模板方法，减少重复代码（如批量操作、条件查询）；</li>
<li><strong>最佳实践</strong>：
<ul>
<li>自定义 Service 接口继承 <code>IService</code>，实现类继承 <code>ServiceImpl</code>；</li>
<li>简单 CRUD 直接复用 <code>IService</code> 方法，复杂业务在实现类中扩展；</li>
<li>动态条件优先使用 <code>lambdaQuery()</code>/<code>lambdaUpdate()</code>，避免硬编码；</li>
<li>批量操作务必开启 <code>rewriteBatchedStatements</code> 参数优化性能。</li>
</ul>
</li>
</ol>
<h1>四、MyBatis-Plus 扩展功能</h1>
<p>MyBatis-Plus 除核心 CRUD 能力外，还提供了一系列 <strong>高频场景扩展功能</strong>，覆盖代码生成、类型转换、敏感配置加密等开发痛点，旨在进一步简化开发流程、提升系统健壮性。</p>
<h2 id="4-1-代码生成：一键生成重复代码">4.1 代码生成：一键生成重复代码</h2>
<p>基础的 PO、Mapper、Service 等代码存在大量重复编写工作，MyBatis-Plus 提供两种代码生成方案：<strong>Idea 图形化插件</strong>（便捷）和 <strong>官方代码生成器</strong>（灵活），可根据数据库表结构自动生成全套基础代码。</p>
<h3 id="4-1-1-方案一：Idea-插件生成（推荐新手）">4.1.1 方案一：Idea 插件生成（推荐新手）</h3>
<p>通过 Idea 插件实现图形化配置，无需编写生成逻辑，直接生成代码。</p>
<h4 id="1-安装插件">1. 安装插件</h4>
<p>在 Idea 的 <code>Plugins</code> 市场搜索 <strong>MyBatisPlus</strong>，选择下载量高的插件（如 “mybatis-plus” 或 “Custom MybatisPlus Generator”），安装后重启 Idea。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://a1.boltp.com/2025/09/19/68cd4ee78ba99.png" alt=""></p>
<h4 id="2-使用步骤">2. 使用步骤</h4>
<p>以生成 <code>address</code> 表的基础代码为例：</p>
<ol>
<li>
<p><strong>配置数据库连接</strong>：顶部菜单选择 <code>Other</code> → <code>Config Database</code>，填写数据库 URL、用户名、密码，测试连接通过后保存。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://a1.boltp.com/2025/09/19/68cd4f83d0f25.png" alt=""></p>
</li>
<li>
<p><strong>配置生成参数</strong>：再次选择 <code>Other</code> → <code>Code Generator</code>，填写核心参数：</p>
<ul>
<li><code>package</code>：父包路径（如 <code>com.itheima.mp</code>）；</li>
<li><code>Entity</code>：实体类包路径（如 <code>domain.po</code>）；</li>
<li><code>TablePrefix</code>：表前缀（如无则留空）；</li>
<li><code>Id策略</code>：与数据库主键策略一致（如 <code>AUTO</code> 自增）；</li>
<li>勾选需生成的组件（Entity、Mapper、Service、Controller 等）。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://a1.boltp.com/2025/09/19/68cd4fb0f34cb.png" alt=""></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://a1.boltp.com/2025/09/19/68cd500ca566e.png" alt="img"></p>
</li>
<li>
<p><strong>生成代码</strong>：点击 “提交”，插件自动在指定包路径下生成代码，包含 PO 实体、Mapper 接口、Service 及实现类。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://a1.boltp.com/2025/09/19/68cd50213e948.png" alt=""></p>
</li>
</ol>
<h3 id="4-1-2-方案二：官方代码生成器（灵活定制，可跳过）">4.1.2 方案二：官方代码生成器（灵活定制，可跳过）</h3>
<p>通过编写 Java 代码配置生成逻辑，支持个性化定制（如 Lombok 注解、REST 风格 Controller 等），适合复杂场景。</p>
<p>因为MP代码生成更新迭代速度很快，若本文的API被弃用，请以官网最新版本API为准：</p>
<p>MyBatis-Plus新代码生成器：<a target="_blank" rel="noopener" href="https://baomidou.com/guides/new-code-generator/">https://baomidou.com/guides/new-code-generator/</a></p>
<p>代码生成器配置：<a target="_blank" rel="noopener" href="https://baomidou.com/reference/new-code-generator-configuration/">https://baomidou.com/reference/new-code-generator-configuration/</a></p>
<h4 id="1-引入依赖">1. 引入依赖</h4>
<p>在 <code>pom.xml</code> 中添加代码生成器依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- MP代码生成器 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-generator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.9<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h4 id="2-编写生成配置">2. 编写生成配置</h4>
<p>创建 <code>CodeGenerator</code> 类，配置数据库连接、包路径、生成策略等参数：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.generator.FastAutoGenerator;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.generator.config.OutputFile;<br><br><span class="hljs-keyword">import</span> java.util.Collections;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CodeGenerator</span> &#123;<br>    <span class="hljs-comment">// 数据库连接参数</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">JDBC_URL</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;jdbc:mysql://127.0.0.1:3306/mp?useUnicode=true&amp;characterEncoding=UTF-8&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">JDBC_USER</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;root&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">JDBC_PWD</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;123456&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">// 生成表名（可批量）</span><br>        List&lt;String&gt; tables = List.of(<span class="hljs-string">&quot;address&quot;</span>);<br>        <span class="hljs-comment">// 输出路径（项目java目录）</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">outputDir</span> <span class="hljs-operator">=</span> System.getProperty(<span class="hljs-string">&quot;user.dir&quot;</span>) + <span class="hljs-string">&quot;/src/main/java&quot;</span>;<br><br>        FastAutoGenerator.create(JDBC_URL, JDBC_USER, JDBC_PWD)<br>                <span class="hljs-comment">// 1. 全局配置</span><br>                .globalConfig(builder -&gt; &#123;<br>                    builder.author(<span class="hljs-string">&quot;Aizen&quot;</span>)          <span class="hljs-comment">// 作者</span><br>                            .outputDir(outputDir)   <span class="hljs-comment">// 输出路径</span><br>                            .enableSwagger()        <span class="hljs-comment">// 开启Swagger注解</span><br>                            .commentDate(<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>); <span class="hljs-comment">// 注释日期格式</span><br>                &#125;)<br>                <span class="hljs-comment">// 2. 包配置</span><br>                .packageConfig(builder -&gt; &#123;<br>                    builder.parent(<span class="hljs-string">&quot;com.itheima.mp&quot;</span>) <span class="hljs-comment">// 父包名</span><br>                            .entity(<span class="hljs-string">&quot;domain.po&quot;</span>)    <span class="hljs-comment">// 实体类包</span><br>                            .mapper(<span class="hljs-string">&quot;mapper&quot;</span>)       <span class="hljs-comment">// Mapper接口包</span><br>                            .service(<span class="hljs-string">&quot;service&quot;</span>)     <span class="hljs-comment">// Service接口包</span><br>                            .serviceImpl(<span class="hljs-string">&quot;service.impl&quot;</span>) <span class="hljs-comment">// Service实现包</span><br>                            .controller(<span class="hljs-string">&quot;controller&quot;</span>) <span class="hljs-comment">// Controller包</span><br>                            .xml(<span class="hljs-string">&quot;src/main/resources/mapper&quot;</span>); <span class="hljs-comment">// Mapper XML路径</span><br>                &#125;)<br>                <span class="hljs-comment">// 3. 策略配置</span><br>                .strategyConfig(builder -&gt; &#123;<br>                    builder.addInclude(tables)       <span class="hljs-comment">// 要生成的表</span><br>                            .addTablePrefix()       <span class="hljs-comment">// 表前缀（如无则不填）</span><br>                            <span class="hljs-comment">// 实体类策略</span><br>                            .entityBuilder()<br>                            .enableLombok()         <span class="hljs-comment">// 启用Lombok</span><br>                            .enableTableFieldAnnotation() <span class="hljs-comment">// 生成字段注解</span><br>                            <span class="hljs-comment">// Service策略</span><br>                            .serviceBuilder()<br>                            .formatServiceFileName(<span class="hljs-string">&quot;%sService&quot;</span>)<br>                            .formatServiceImplFileName(<span class="hljs-string">&quot;%sServiceImpl&quot;</span>)<br>                            <span class="hljs-comment">// Controller策略</span><br>                            .controllerBuilder()<br>                            .enableRestStyle()      <span class="hljs-comment">// 启用REST风格</span><br>                            <span class="hljs-comment">// Mapper策略</span><br>                            .mapperBuilder()<br>                            .superClass(BaseMapper.class) <span class="hljs-comment">// 继承BaseMapper</span><br>                            .enableBaseResultMap(); <span class="hljs-comment">// 生成通用ResultMap</span><br>                &#125;)<br>                .execute(); <span class="hljs-comment">// 执行生成</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="3-执行生成">3. 执行生成</h4>
<p>运行 <code>CodeGenerator.main()</code> 方法，代码会自动生成到指定包路径，无需手动编写重复代码。</p>
<h2 id="4-2-静态工具-Db：解决-Service-循环依赖">4.2 静态工具 Db：解决 Service 循环依赖</h2>
<p>当 Service 之间相互调用时，易出现 <strong>循环依赖</strong> 问题。MyBatis-Plus 提供静态工具类 <code>Db</code>，封装了与 <code>IService</code> 一致的 CRUD 方法，无需注入 Service 即可实现数据操作，从根源避免循环依赖。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://a1.boltp.com/2025/09/19/68cd518714fbe.png" alt=""></p>
<h3 id="4-2-1-核心特性">4.2.1 核心特性</h3>
<ul>
<li>无需注入 Service，通过静态方法直接调用；</li>
<li>需传入 PO 类的 <code>Class</code> 字节码（静态方法无法读取泛型，通过反射获取表信息）；</li>
<li>方法签名与 <code>IService</code> 基本一致，学习成本低。</li>
</ul>
<h3 id="4-2-2-基础使用示例">4.2.2 基础使用示例</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.toolkit.Db;<br><span class="hljs-keyword">import</span> org.junit.jupiter.api.Test;<br><span class="hljs-keyword">import</span> org.springframework.boot.test.context.SpringBootTest;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DbToolTest</span> &#123;<br><br>    <span class="hljs-comment">// 1. 根据ID查询</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testDbGetById</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> Db.getById(<span class="hljs-number">1L</span>, User.class); <span class="hljs-comment">// 需传入PO的Class</span><br>        System.out.println(<span class="hljs-string">&quot;用户：&quot;</span> + user);<br>    &#125;<br><br>    <span class="hljs-comment">// 2. 条件查询</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testDbLambdaQuery</span><span class="hljs-params">()</span> &#123;<br>        List&lt;User&gt; userList = Db.lambdaQuery(User.class)<br>                .like(User::getUsername, <span class="hljs-string">&quot;o&quot;</span>)<br>                .ge(User::getBalance, <span class="hljs-number">1000</span>)<br>                .list();<br>        userList.forEach(System.out::println);<br>    &#125;<br><br>    <span class="hljs-comment">// 3. 更新操作</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testDbLambdaUpdate</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> Db.lambdaUpdate(User.class)<br>                .set(User::getBalance, <span class="hljs-number">2000</span>)<br>                .eq(User::getUsername, <span class="hljs-string">&quot;Rose&quot;</span>)<br>                .update();<br>        System.out.println(<span class="hljs-string">&quot;更新成功：&quot;</span> + success);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="4-2-3-实战案例：查询用户及关联地址">4.2.3 实战案例：查询用户及关联地址</h3>
<h4 id="案例-1：查询单个用户及地址">案例 1：查询单个用户及地址</h4>
<p><strong>需求</strong>：查询用户时返回其所有收货地址，避免注入 <code>IAddressService</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ServiceImpl</span>&lt;UserMapper, User&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IUserService</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> UserVO <span class="hljs-title function_">queryUserAndAddressById</span><span class="hljs-params">(Long id)</span> &#123;<br>        <span class="hljs-comment">// 1. 查询用户（自身Service方法）</span><br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> getById(id);<br>        <span class="hljs-keyword">if</span> (user == <span class="hljs-literal">null</span> || user.getStatus() == <span class="hljs-number">2</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;用户不存在或冻结&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-comment">// 2. 查询地址（用Db工具，无需注入AddressService）</span><br>        List&lt;Address&gt; addresses = Db.lambdaQuery(Address.class)<br>                .eq(Address::getUserId, id)<br>                .list();<br><br>        <span class="hljs-comment">// 3. 封装VO</span><br>        <span class="hljs-type">UserVO</span> <span class="hljs-variable">userVO</span> <span class="hljs-operator">=</span> BeanUtil.copyProperties(user, UserVO.class);<br>        userVO.setAddresses(BeanUtil.copyToList(addresses, AddressVO.class));<br>        <span class="hljs-keyword">return</span> userVO;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="案例-2：批量查询用户及地址">案例 2：批量查询用户及地址</h4>
<p><strong>需求</strong>：批量查询用户时，批量关联地址并分组匹配。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> List&lt;UserVO&gt; <span class="hljs-title function_">queryUserAndAddressByIds</span><span class="hljs-params">(List&lt;Long&gt; ids)</span> &#123;<br>    <span class="hljs-comment">// 1. 批量查询用户</span><br>    List&lt;User&gt; users = listByIds(ids);<br>    <span class="hljs-keyword">if</span> (users.isEmpty()) <span class="hljs-keyword">return</span> Collections.emptyList();<br><br>    <span class="hljs-comment">// 2. 批量查询所有用户的地址（一次查询，减少数据库交互）</span><br>    List&lt;Long&gt; userIds = users.stream().map(User::getId).toList();<br>    List&lt;Address&gt; addresses = Db.lambdaQuery(Address.class)<br>            .in(Address::getUserId, userIds)<br>            .list();<br><br>    <span class="hljs-comment">// 3. 地址按用户ID分组（Map&lt;用户ID, 地址列表&gt;）</span><br>    Map&lt;Long, List&lt;AddressVO&gt;&gt; addressMap = addresses.stream()<br>            .map(addr -&gt; BeanUtil.copyProperties(addr, AddressVO.class))<br>            .collect(Collectors.groupingBy(AddressVO::getUserId));<br><br>    <span class="hljs-comment">// 4. 封装VO</span><br>    <span class="hljs-keyword">return</span> users.stream()<br>            .map(user -&gt; &#123;<br>                <span class="hljs-type">UserVO</span> <span class="hljs-variable">vo</span> <span class="hljs-operator">=</span> BeanUtil.copyProperties(user, UserVO.class);<br>                vo.setAddresses(addressMap.getOrDefault(user.getId(), Collections.emptyList()));<br>                <span class="hljs-keyword">return</span> vo;<br>            &#125;)<br>            .toList();<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="4-3-逻辑删除：避免数据物理删除">4.3 逻辑删除：避免数据物理删除</h2>
<p>对于核心数据（如用户、订单），物理删除（DELETE）会导致数据丢失，通常采用 <strong>逻辑删除</strong> 方案：通过字段标记数据状态，删除时仅修改标记，查询时过滤已标记的数据。MyBatis-Plus 可自动处理逻辑删除的 SQL 拼接，无需手动修改 CRUD 方法。</p>
<h3 id="4-3-1-实现步骤">4.3.1 实现步骤</h3>
<h4 id="1-数据库添加逻辑删除字段">1. 数据库添加逻辑删除字段</h4>
<p>以 <code>address</code> 表为例，添加 <code>deleted</code> 字段（布尔型，默认 <code>0</code> 未删除）：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER TABLE</span> address <span class="hljs-keyword">ADD</span> deleted BIT <span class="hljs-keyword">DEFAULT</span> b<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;逻辑删除（0未删，1已删）&#x27;</span>;<br></code></pre></td></tr></table></figure>
<h4 id="2-配置逻辑删除">2. 配置逻辑删除</h4>
<p>两种配置方式：<strong>全局配置</strong>（适用于全表统一规则）或 <strong>注解配置</strong>（适用于单表自定义规则）。</p>
<h5 id="方式-1：全局配置（推荐）">方式 1：全局配置（推荐）</h5>
<p>在 <code>application.yaml</code> 中配置全局逻辑删除规则：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">mybatis-plus:</span><br>  <span class="hljs-attr">global-config:</span><br>    <span class="hljs-attr">db-config:</span><br>      <span class="hljs-attr">logic-delete-field:</span> <span class="hljs-string">deleted</span>  <span class="hljs-comment"># 全局逻辑删除字段名</span><br>      <span class="hljs-attr">logic-not-delete-value:</span> <span class="hljs-number">0</span>     <span class="hljs-comment"># 未删除值（默认0）</span><br>      <span class="hljs-attr">logic-delete-value:</span> <span class="hljs-number">1</span>         <span class="hljs-comment"># 已删除值（默认1）</span><br></code></pre></td></tr></table></figure>
<h5 id="方式-2：注解配置（单表自定义）">方式 2：注解配置（单表自定义）</h5>
<p>在 PO 类的逻辑删除字段上添加 <code>@TableLogic</code> 注解，覆盖全局配置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@TableName(&quot;address&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Address</span> &#123;<br>    <span class="hljs-comment">// 其他字段省略...</span><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 逻辑删除</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@TableLogic(value = &quot;0&quot;, delval = &quot;1&quot;)</span> <span class="hljs-comment">// value=未删值，delval=已删值</span><br>    <span class="hljs-keyword">private</span> Boolean deleted;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="3-测试逻辑删除">3. 测试逻辑删除</h4>
<p>调用普通 CRUD 方法，MP 会自动处理逻辑删除：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogicDeleteTest</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> IAddressService addressService;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testRemove</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// 1. 执行删除（实际执行UPDATE，而非DELETE）</span><br>        addressService.removeById(<span class="hljs-number">59L</span>);<br><br>        <span class="hljs-comment">// 2. 查询已删除数据（自动过滤，返回null）</span><br>        <span class="hljs-type">Address</span> <span class="hljs-variable">address</span> <span class="hljs-operator">=</span> addressService.getById(<span class="hljs-number">59L</span>);<br>        System.out.println(<span class="hljs-string">&quot;查询结果：&quot;</span> + address); <span class="hljs-comment">// null</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><strong>生成的 SQL</strong>：</p>
<ul>
<li>删除：<code>UPDATE address SET deleted=1 WHERE id=? AND deleted=0</code></li>
<li>查询：<code>SELECT * FROM address WHERE id=? AND deleted=0</code></li>
</ul>
<h3 id="4-3-2-注意事项">4.3.2 注意事项</h3>
<ul>
<li>仅 MP 自动生成的 SQL 支持逻辑删除，<strong>自定义 SQL 需手动添加 <code>deleted</code> 条件</strong>；</li>
<li>逻辑删除会导致表中 “垃圾数据” 累积，影响查询效率，建议定期将已删除数据迁移至历史表；</li>
<li>不适用于需彻底清理数据的场景（如测试数据）。</li>
</ul>
<h2 id="4-4-枚举处理器：枚举与数据库字段自动转换">4.4 枚举处理器：枚举与数据库字段自动转换</h2>
<p>当 PO 类属性为枚举类型时，MyBatis 默认使用 <code>EnumOrdinalTypeHandler</code>（存储枚举索引），灵活性差。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://a1.boltp.com/2025/09/19/68cd530fa4fa4.png" alt=""></p>
<p>MyBatis-Plus 提供 <code>MybatisEnumTypeHandler</code>，支持将枚举的指定属性（如 <code>value</code>）与数据库字段映射，且支持 JSON 序列化自定义。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://a1.boltp.com/2025/09/19/68cd533735419.png" alt=""></p>
<h3 id="4-4-1-实现步骤">4.4.1 实现步骤</h3>
<h4 id="1-定义枚举并标记-EnumValue">1. 定义枚举并标记 <code>@EnumValue</code></h4>
<p>用 <code>@EnumValue</code> 注解标记枚举中与数据库字段对应的属性：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.EnumValue;<br><span class="hljs-keyword">import</span> com.fasterxml.jackson.annotation.JsonValue;<br><span class="hljs-keyword">import</span> lombok.Getter;<br><br><span class="hljs-meta">@Getter</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">UserStatus</span> &#123;<br>    NORMAL(<span class="hljs-number">1</span>, <span class="hljs-string">&quot;正常&quot;</span>),  <span class="hljs-comment">// 数据库存1，前端显示&quot;正常&quot;</span><br>    FREEZE(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;冻结&quot;</span>); <span class="hljs-comment">// 数据库存2，前端显示&quot;冻结&quot;</span><br><br>    <span class="hljs-meta">@EnumValue</span>  <span class="hljs-comment">// 标记数据库存储的属性</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> value;<br><br>    <span class="hljs-meta">@JsonValue</span>  <span class="hljs-comment">// 标记JSON序列化返回的属性（前端展示用）</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String desc;<br><br>    UserStatus(<span class="hljs-type">int</span> value, String desc) &#123;<br>        <span class="hljs-built_in">this</span>.value = value;<br>        <span class="hljs-built_in">this</span>.desc = desc;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="2-配置全局枚举处理器">2. 配置全局枚举处理器</h4>
<p>在 <code>application.yaml</code> 中指定默认枚举处理器：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">mybatis-plus:</span><br>  <span class="hljs-attr">configuration:</span><br>    <span class="hljs-attr">default-enum-type-handler:</span> <span class="hljs-string">com.baomidou.mybatisplus.core.handlers.MybatisEnumTypeHandler</span><br></code></pre></td></tr></table></figure>
<h4 id="3-改造-PO-类">3. 改造 PO 类</h4>
<p>将 PO 类中的状态字段改为枚举类型：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@TableName(&quot;user&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>    <span class="hljs-comment">// 其他字段省略...</span><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 用户状态（1正常，2冻结）</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> UserStatus status;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="4-4-2-测试效果">4.4.2 测试效果</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testEnumQuery</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// 查询状态为正常的用户</span><br>    List&lt;User&gt; users = userService.lambdaQuery()<br>            .eq(User::getStatus, UserStatus.NORMAL)<br>            .list();<br>    <br>    <span class="hljs-comment">// 输出结果：status字段为枚举对象，JSON返回desc属性</span><br>    users.forEach(user -&gt; System.out.println(user.getStatus().getDesc())); <span class="hljs-comment">// 正常、正常...</span><br>&#125;<br></code></pre></td></tr></table></figure>
<p><strong>生成的 SQL</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> ?  <span class="hljs-comment">-- 参数：1（UserStatus.NORMAL的value）</span><br></code></pre></td></tr></table></figure>
<h2 id="4-5-JSON-类型处理器：JSON-字段与对象自动转换">4.5 JSON 类型处理器：JSON 字段与对象自动转换</h2>
<p>数据库中 JSON 类型字段（如 <code>user.info</code>）默认以字符串形式映射到 PO 类，读取其中属性需手动解析 JSON。MyBatis-Plus 提供 <code>JacksonTypeHandler</code>，可将 JSON 字段直接映射为 Java 对象（如 <code>UserInfo</code>），实现自动序列化 / 反序列化。</p>
<h3 id="4-5-1-实现步骤">4.5.1 实现步骤</h3>
<h4 id="1-定义-JSON-对应的实体类">1. 定义 JSON 对应的实体类</h4>
<p>创建与 JSON 字段结构匹配的实体类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@AllArgsConstructor(staticName = &quot;of&quot;)</span> <span class="hljs-comment">// 便捷构建对象</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserInfo</span> &#123;<br>    <span class="hljs-keyword">private</span> Integer age;    <span class="hljs-comment">// 对应JSON的age字段</span><br>    <span class="hljs-keyword">private</span> String intro;   <span class="hljs-comment">// 对应JSON的intro字段</span><br>    <span class="hljs-keyword">private</span> String gender;  <span class="hljs-comment">// 对应JSON的gender字段</span><br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="2-改造-PO-类">2. 改造 PO 类</h4>
<p>指定 JSON 字段的类型处理器，并开启自动 ResultMap 映射：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@TableName(value = &quot;user&quot;, autoResultMap = true)</span> <span class="hljs-comment">// 开启自动ResultMap（解决嵌套映射问题）</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>    <span class="hljs-comment">// 其他字段省略...</span><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 详细信息（JSON类型）</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@TableField(typeHandler = JacksonTypeHandler.class)</span> <span class="hljs-comment">// 指定JSON处理器</span><br>    <span class="hljs-keyword">private</span> UserInfo info;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="3-测试自动转换">3. 测试自动转换</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testJsonField</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// 1. 新增用户（自动将UserInfo转为JSON字符串）</span><br>    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>    user.setUsername(<span class="hljs-string">&quot;JsonTest&quot;</span>);<br>    user.setInfo(UserInfo.of(<span class="hljs-number">25</span>, <span class="hljs-string">&quot;技术宅&quot;</span>, <span class="hljs-string">&quot;male&quot;</span>)); <span class="hljs-comment">// 直接设置对象</span><br>    userService.save(user);<br><br>    <span class="hljs-comment">// 2. 查询用户（自动将JSON字符串转为UserInfo）</span><br>    <span class="hljs-type">User</span> <span class="hljs-variable">queryUser</span> <span class="hljs-operator">=</span> userService.getById(user.getId());<br>    System.out.println(<span class="hljs-string">&quot;用户年龄：&quot;</span> + queryUser.getInfo().getAge()); <span class="hljs-comment">// 25</span><br>&#125;<br></code></pre></td></tr></table></figure>
<p><strong>生成的 SQL</strong>：</p>
<ul>
<li>新增：<code>INSERT INTO user (username, info) VALUES (?, ?)</code> → 参数：<code>JsonTest</code>、<code>&#123;&quot;age&quot;:25,&quot;intro&quot;:&quot;技术宅&quot;,&quot;gender&quot;:&quot;male&quot;&#125;</code></li>
<li>查询：自动将 JSON 字符串解析为 <code>UserInfo</code> 对象。</li>
</ul>
<h2 id="4-6-YAML-配置加密：保护敏感信息">4.6 YAML 配置加密：保护敏感信息</h2>
<p>配置文件中数据库用户名、密码等敏感信息以明文存储，存在泄露风险。MyBatis-Plus 基于 AES 算法提供配置加密功能，可对敏感信息加密存储，启动时解密。</p>
<h3 id="4-6-1-实现步骤">4.6.1 实现步骤</h3>
<h4 id="1-生成密钥与密文">1. 生成密钥与密文</h4>
<p>使用 MP 提供的 <code>AES</code> 工具生成 16 位密钥，并加密用户名 / 密码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.toolkit.AES;<br><span class="hljs-keyword">import</span> org.junit.jupiter.api.Test;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigEncryptTest</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">USERNAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;root&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">PASSWORD</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;123456&quot;</span>;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">generateEncryptInfo</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// 1. 生成16位随机AES密钥</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> AES.generateRandomKey();<br>        System.out.println(<span class="hljs-string">&quot;密钥：&quot;</span> + key); <span class="hljs-comment">// 例：7pSEa6F9TnYacTNJ</span><br><br>        <span class="hljs-comment">// 2. 加密用户名和密码</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">encryptUsername</span> <span class="hljs-operator">=</span> AES.encrypt(USERNAME, key);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">encryptPassword</span> <span class="hljs-operator">=</span> AES.encrypt(PASSWORD, key);<br>        System.out.println(<span class="hljs-string">&quot;加密后用户名：&quot;</span> + encryptUsername); <span class="hljs-comment">// 例：O4Yq+WKYGlPW5t8QvgrhUQ==</span><br>        System.out.println(<span class="hljs-string">&quot;加密后密码：&quot;</span> + encryptPassword);   <span class="hljs-comment">// 例：cDYHnWysq07zUIAy1tcbRQ==</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="2-修改配置文件">2. 修改配置文件</h4>
<p>将密文写入 <code>application.yaml</code>，密文需以 <code>mpw:</code> 为前缀：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://127.0.0.1:3306/mp?useUnicode=true&amp;characterEncoding=UTF-8</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">mpw:O4Yq+WKYGlPW5t8QvgrhUQ==</span>  <span class="hljs-comment"># 加密用户名</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-string">mpw:cDYHnWysq07zUIAy1tcbRQ==</span>  <span class="hljs-comment"># 加密密码</span><br></code></pre></td></tr></table></figure>
<h4 id="3-配置启动密钥">3. 配置启动密钥</h4>
<p>启动项目时传入密钥，支持两种方式：</p>
<ul>
<li><strong>Idea 启动</strong>：在 <code>Run/Debug Configurations</code> 的 <code>Program arguments</code> 中添加 <code>--mpw.key=7pSEa6F9TnYacTNJ</code>；</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://a1.boltp.com/2025/09/19/68cd54c2838fb.png" alt=""></p>
<ul>
<li>
<p><strong>单元测试</strong>：在测试类注解中添加密钥：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest(args = &quot;--mpw.key=7pSEa6F9TnYacTNJ&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceTest</span> &#123;<br>    <span class="hljs-comment">// 测试代码...</span><br>&#125;<br></code></pre></td></tr></table></figure>
</li>
</ul>
<p>随意运行一个单元测试，可以发现数据库查询正常。</p>
<h3 id="4-6-2-实现原理">4.6.2 实现原理</h3>
<p>MP 通过重写 Spring 的 <code>EnvironmentPostProcessor</code> 接口，在项目启动前执行以下逻辑：</p>
<ol>
<li>从启动参数中读取密钥 <code>mpw.key</code>；</li>
<li>遍历配置文件中以 <code>mpw:</code> 为前缀的属性，用密钥解密；</li>
<li>将解密后的明文放入环境变量，覆盖密文配置。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.baomidou.mybatisplus.autoconfigure;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.toolkit.AES;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.toolkit.CollectionUtils;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.toolkit.StringUtils;<br><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<br><span class="hljs-keyword">import</span> org.springframework.boot.env.EnvironmentPostProcessor;<br><span class="hljs-keyword">import</span> org.springframework.boot.env.OriginTrackedMapPropertySource;<br><span class="hljs-keyword">import</span> org.springframework.core.env.ConfigurableEnvironment;<br><span class="hljs-keyword">import</span> org.springframework.core.env.MapPropertySource;<br><span class="hljs-keyword">import</span> org.springframework.core.env.PropertySource;<br><span class="hljs-keyword">import</span> org.springframework.core.env.SimpleCommandLinePropertySource;<br><br><span class="hljs-keyword">import</span> java.util.HashMap;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 安全加密处理器</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> hubin</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@since</span> 2020-05-23</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SafetyEncryptProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">EnvironmentPostProcessor</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessEnvironment</span><span class="hljs-params">(ConfigurableEnvironment environment, SpringApplication application)</span> &#123;<br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * 命令行中获取密钥</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">mpwKey</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">for</span> (PropertySource&lt;?&gt; ps : environment.getPropertySources()) &#123;<br>            <span class="hljs-keyword">if</span> (ps <span class="hljs-keyword">instanceof</span> SimpleCommandLinePropertySource) &#123;<br>                <span class="hljs-type">SimpleCommandLinePropertySource</span> <span class="hljs-variable">source</span> <span class="hljs-operator">=</span> (SimpleCommandLinePropertySource) ps;<br>                mpwKey = source.getProperty(<span class="hljs-string">&quot;mpw.key&quot;</span>);<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * 处理加密内容</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-keyword">if</span> (StringUtils.isNotBlank(mpwKey)) &#123;<br>            HashMap&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>            <span class="hljs-keyword">for</span> (PropertySource&lt;?&gt; ps : environment.getPropertySources()) &#123;<br>                <span class="hljs-keyword">if</span> (ps <span class="hljs-keyword">instanceof</span> OriginTrackedMapPropertySource) &#123;<br>                    <span class="hljs-type">OriginTrackedMapPropertySource</span> <span class="hljs-variable">source</span> <span class="hljs-operator">=</span> (OriginTrackedMapPropertySource) ps;<br>                    <span class="hljs-keyword">for</span> (String name : source.getPropertyNames()) &#123;<br>                        <span class="hljs-type">Object</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> source.getProperty(name);<br>                        <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> String) &#123;<br>                            <span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> (String) value;<br>                            <span class="hljs-keyword">if</span> (str.startsWith(<span class="hljs-string">&quot;mpw:&quot;</span>)) &#123;<br>                                map.put(name, AES.decrypt(str.substring(<span class="hljs-number">4</span>), mpwKey));<br>                            &#125;<br>                        &#125;<br>                    &#125;<br>                &#125;<br>            &#125;<br>            <span class="hljs-comment">// 将解密的数据放入环境变量，并处于第一优先级上</span><br>            <span class="hljs-keyword">if</span> (CollectionUtils.isNotEmpty(map)) &#123;<br>                environment.getPropertySources().addFirst(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MapPropertySource</span>(<span class="hljs-string">&quot;custom-encrypt&quot;</span>, map));<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="4-7-自动填充：字段值自动赋值">4.7 自动填充：字段值自动赋值</h2>
<p>对于创建时间（<code>create_time</code>）、更新时间（<code>update_time</code>）等通用字段，每次新增 / 更新都需手动赋值。MyBatis-Plus 提供自动填充功能，通过配置处理器实现字段值的自动填充。</p>
<h3 id="4-7-1-实现步骤">4.7.1 实现步骤</h3>
<h4 id="1-实现填充处理器">1. 实现填充处理器</h4>
<p>创建类实现 <code>MetaObjectHandler</code> 接口，定义填充逻辑：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.handlers.MetaObjectHandler;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.apache.ibatis.reflection.MetaObject;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-keyword">import</span> java.time.LocalDateTime;<br><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Component</span> <span class="hljs-comment">// 交给Spring管理</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyMetaObjectHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MetaObjectHandler</span> &#123;<br><br>    <span class="hljs-comment">// 新增时填充</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertFill</span><span class="hljs-params">(MetaObject metaObject)</span> &#123;<br>        log.info(<span class="hljs-string">&quot;执行新增填充...&quot;</span>);<br>        <span class="hljs-comment">// 填充创建时间（仅当字段为null时填充）</span><br>        <span class="hljs-built_in">this</span>.strictInsertFill(<br>                metaObject, <br>                <span class="hljs-string">&quot;createTime&quot;</span>,  <span class="hljs-comment">// PO类中的字段名</span><br>                LocalDateTime.class, <br>                LocalDateTime.now()  <span class="hljs-comment">// 填充值</span><br>        );<br>        <span class="hljs-comment">// 填充更新时间（新增时也需赋值）</span><br>        <span class="hljs-built_in">this</span>.strictInsertFill(metaObject, <span class="hljs-string">&quot;updateTime&quot;</span>, LocalDateTime.class, LocalDateTime.now());<br>    &#125;<br><br>    <span class="hljs-comment">// 更新时填充</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateFill</span><span class="hljs-params">(MetaObject metaObject)</span> &#123;<br>        log.info(<span class="hljs-string">&quot;执行更新填充...&quot;</span>);<br>        <span class="hljs-comment">// 填充更新时间</span><br>        <span class="hljs-built_in">this</span>.strictUpdateFill(metaObject, <span class="hljs-string">&quot;updateTime&quot;</span>, LocalDateTime.class, LocalDateTime.now());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="2-标记-PO-类字段">2. 标记 PO 类字段</h4>
<p>用 <code>@TableField(fill)</code> 注解标记需要自动填充的字段：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@TableName(&quot;user&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>    <span class="hljs-comment">// 其他字段省略...</span><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 创建时间（仅新增时填充）</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT)</span><br>    <span class="hljs-keyword">private</span> LocalDateTime createTime;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 更新时间（新增和更新时填充）</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span><br>    <span class="hljs-keyword">private</span> LocalDateTime updateTime;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="3-测试自动填充">3. 测试自动填充</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testAutoFill</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>    user.setUsername(<span class="hljs-string">&quot;AutoFillTest&quot;</span>);<br>    userService.save(user); <span class="hljs-comment">// 无需手动设置createTime和updateTime</span><br><br>    <span class="hljs-comment">// 验证填充结果</span><br>    <span class="hljs-type">User</span> <span class="hljs-variable">queryUser</span> <span class="hljs-operator">=</span> userService.getById(user.getId());<br>    System.out.println(<span class="hljs-string">&quot;创建时间：&quot;</span> + queryUser.getCreateTime()); <span class="hljs-comment">// 自动赋值当前时间</span><br>    System.out.println(<span class="hljs-string">&quot;更新时间：&quot;</span> + queryUser.getUpdateTime()); <span class="hljs-comment">// 与创建时间一致</span><br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="4-7-2-注意事项">4.7.2 注意事项</h3>
<ul>
<li>填充逻辑仅对 <code>insert(T)</code>、<code>updateById(T)</code> 等传入实体对象的方法生效，<code>update(Wrapper&lt;T&gt;)</code> 需手动赋值；</li>
<li><code>strictInsertFill</code>/<code>strictUpdateFill</code> 会严格匹配字段名和类型，避免误填充；</li>
<li>若实体类字段已手动赋值，填充逻辑不会覆盖（默认策略）。</li>
</ul>
<h1>五、MyBatis-Plus 插件功能</h1>
<p>MyBatis-Plus 基于 MyBatis 的拦截器机制，提供了一系列 <strong>可插拔插件</strong>，用于拓展核心功能（如分页、多租户、乐观锁等）。插件只需简单配置即可启用，且支持多插件组合使用（需注意配置顺序）。本章以最常用的 <strong>分页插件</strong> 为核心，详解插件的使用流程与实战技巧。</p>
<h2 id="5-1-插件体系概述">5.1 插件体系概述</h2>
<p>MyBatis-Plus 内置多款实用插件，覆盖分页、数据安全、SQL 规范等高频场景，核心插件及功能如下：</p>
<table>
<thead>
<tr>
<th>插件类名</th>
<th>核心功能</th>
<th>适用场景</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>PaginationInnerInterceptor</code></td>
<td>自动分页（拦截查询 SQL，拼接分页语句）</td>
<td>列表查询分页需求</td>
</tr>
<tr>
<td><code>TenantLineInnerInterceptor</code></td>
<td>多租户（自动拼接租户 ID 条件）</td>
<td>多租户系统数据隔离</td>
</tr>
<tr>
<td><code>DynamicTableNameInnerInterceptor</code></td>
<td>动态表名（运行时切换表名）</td>
<td>分表场景（如按时间分表）</td>
</tr>
<tr>
<td><code>OptimisticLockerInnerInterceptor</code></td>
<td>乐观锁（基于版本号防止并发更新冲突）</td>
<td>高并发更新场景（如余额修改）</td>
</tr>
<tr>
<td><code>IllegalSQLInnerInterceptor</code></td>
<td>SQL 性能规范（检测垃圾 SQL，如 SELECT *）</td>
<td>规范 SQL 编写，提升性能</td>
</tr>
<tr>
<td><code>BlockAttackInnerInterceptor</code></td>
<td>防止全表更新 / 删除（拦截无 WHERE 条件的 DML）</td>
<td>避免误操作导致全表数据变更</td>
</tr>
</tbody>
</table>
<h3 id="5-1-1-插件配置顺序">5.1.1 插件配置顺序</h3>
<p>多插件组合使用时，需按以下顺序添加到拦截器，避免功能冲突：</p>
<ol>
<li>多租户插件（<code>TenantLineInnerInterceptor</code>）→ 动态表名插件（<code>DynamicTableNameInnerInterceptor</code>）</li>
<li>分页插件（<code>PaginationInnerInterceptor</code>）→ 乐观锁插件（<code>OptimisticLockerInnerInterceptor</code>）</li>
<li>SQL 性能规范插件（<code>IllegalSQLInnerInterceptor</code>）→ 防止全表操作插件（<code>BlockAttackInnerInterceptor</code>）</li>
</ol>
<h2 id="5-2-核心插件：分页插件（PaginationInnerInterceptor）">5.2 核心插件：分页插件（PaginationInnerInterceptor）</h2>
<p>MyBatis-Plus 本身不支持分页，需通过分页插件实现 —— 插件会自动拦截查询请求，在 SQL 后拼接分页语句（如 <code>LIMIT</code>），并封装总条数、总页数等分页信息。</p>
<h3 id="5-2-1-步骤-1：引入依赖">5.2.1 步骤 1：引入依赖</h3>
<p>⚠ 注意，MyBatis-Plus 于3.5.9 版本起，分页插件从核心包分离，需单独引入依赖，区分 JDK 版本：</p>
<h4 id="JDK-11-依赖">JDK 11+ 依赖</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- MP分页插件（JDK 11+） --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-jsqlparser<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.9<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h4 id="JDK-8-依赖">JDK 8+ 依赖</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- MP分页插件（JDK 8+） --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-jsqlparser-4.9<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.9<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h3 id="5-2-2-步骤-2：配置分页拦截器">5.2.2 步骤 2：配置分页拦截器</h3>
<p>创建 MyBatis 配置类，初始化核心拦截器并添加分页插件：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.DbType;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.plugins.MybatisPlusInterceptor;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.plugins.inner.PaginationInnerInterceptor;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MybatisConfig</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> MybatisPlusInterceptor <span class="hljs-title function_">mybatisPlusInterceptor</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// 1. 初始化核心拦截器（管理所有内置插件）</span><br>        <span class="hljs-type">MybatisPlusInterceptor</span> <span class="hljs-variable">interceptor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MybatisPlusInterceptor</span>();<br>        <br>        <span class="hljs-comment">// 2. 配置分页插件</span><br>        <span class="hljs-type">PaginationInnerInterceptor</span> <span class="hljs-variable">pageInterceptor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PaginationInnerInterceptor</span>(DbType.MYSQL);<br>        pageInterceptor.setMaxLimit(<span class="hljs-number">1000L</span>); <span class="hljs-comment">// 单页最大条数限制（避免一次查询过多数据）</span><br>        interceptor.addInnerInterceptor(pageInterceptor);<br>        <br>        <span class="hljs-comment">// 如需添加其他插件，按顺序追加：interceptor.addInnerInterceptor(其他插件);</span><br>        <span class="hljs-keyword">return</span> interceptor;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="5-2-3-步骤-3：使用分页-API">5.2.3 步骤 3：使用分页 API</h3>
<p>分页插件依赖 MP 提供的 <code>Page</code> 类封装分页参数，结合 <code>BaseMapper</code> 或 <code>IService</code> 的分页方法实现查询。</p>
<h4 id="基础分页示例">基础分页示例</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.OrderItem;<br><span class="hljs-keyword">import</span> org.junit.jupiter.api.Test;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.boot.test.context.SpringBootTest;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PaginationTest</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> IUserService userService;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testBasicPage</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// 1. 分页参数：第1页，每页2条数据</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">pageNo</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">pageSize</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<br>        Page&lt;User&gt; page = Page.of(pageNo, pageSize);<br><br>        <span class="hljs-comment">// 2. 排序参数：按余额降序（new OrderItem() 为旧写法，推荐静态方法）</span><br>        page.addOrder(OrderItem.desc(<span class="hljs-string">&quot;balance&quot;</span>)); <span class="hljs-comment">// 降序</span><br>        page.addOrder(OrderItem.asc(<span class="hljs-string">&quot;id&quot;</span>));      <span class="hljs-comment">// 再按ID升序</span><br><br>        <span class="hljs-comment">// 3. 执行分页查询（IService.page() 方法）</span><br>        Page&lt;User&gt; resultPage = userService.page(page);<br><br>        <span class="hljs-comment">// 4. 解析分页结果</span><br>        <span class="hljs-type">long</span> <span class="hljs-variable">total</span> <span class="hljs-operator">=</span> resultPage.getTotal();       <span class="hljs-comment">// 总条数</span><br>        <span class="hljs-type">long</span> <span class="hljs-variable">pages</span> <span class="hljs-operator">=</span> resultPage.getPages();       <span class="hljs-comment">// 总页数</span><br>        List&lt;User&gt; records = resultPage.getRecords(); <span class="hljs-comment">// 当前页数据</span><br><br>        System.out.println(<span class="hljs-string">&quot;total = &quot;</span> + total);<br>        System.out.println(<span class="hljs-string">&quot;pages = &quot;</span> + pages);<br>        records.forEach(System.out::println);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="分页查询结果">分页查询结果</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://a1.boltp.com/2025/09/19/68cd5839e384e.png" alt=""></p>
<h4 id="生成的-SQL">生成的 SQL</h4>
<p>插件会自动拼接分页语句，同时查询总条数：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 查询当前页数据</span><br><span class="hljs-keyword">SELECT</span> id,username,balance,... <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> balance <span class="hljs-keyword">DESC</span>, id <span class="hljs-keyword">ASC</span> LIMIT ?, ?<br><span class="hljs-comment">-- 查询总条数</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span><br></code></pre></td></tr></table></figure>
<h2 id="5-3-实战：通用分页实体设计与优化">5.3 实战：通用分页实体设计与优化</h2>
<p>实际开发中，分页查询需适配多业务场景（如动态条件、排序、VO 转换），直接使用 <code>Page</code> 类会导致代码重复。通过设计 <strong>通用分页实体</strong>，可封装分页参数转换、结果封装等逻辑，提升开发效率。</p>
<h3 id="5-3-1-核心实体类设计">5.3.1 核心实体类设计</h3>
<p>需定义 4 个实体类，分别对应 “分页参数接收”“业务条件接收”“分页结果返回”“视图对象”：</p>
<h4 id="1-通用分页参数（PageDTO）">1. 通用分页参数（PageDTO）</h4>
<p>接收前端传入的分页与排序参数，适用于所有分页场景：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.metadata.OrderItem;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;<br><span class="hljs-keyword">import</span> io.swagger.annotations.ApiModel;<br><span class="hljs-keyword">import</span> io.swagger.annotations.ApiModelProperty;<br><span class="hljs-keyword">import</span> lombok.Data;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@ApiModel(description = &quot;通用分页参数&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PageDTO</span> &#123;<br>    <span class="hljs-meta">@ApiModelProperty(&quot;页码（默认1）&quot;)</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Integer</span> <span class="hljs-variable">pageNo</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><br>    <span class="hljs-meta">@ApiModelProperty(&quot;每页条数（默认10）&quot;)</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Integer</span> <span class="hljs-variable">pageSize</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<br><br>    <span class="hljs-meta">@ApiModelProperty(&quot;排序字段（如balance、update_time）&quot;)</span><br>    <span class="hljs-keyword">private</span> String sortBy;<br><br>    <span class="hljs-meta">@ApiModelProperty(&quot;是否升序（true=升序，false=降序）&quot;)</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Boolean</span> <span class="hljs-variable">isAsc</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 转换为MP的Page对象（带排序）</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> &lt;T&gt; 泛型（PO类型）</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> Page对象</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> &lt;T&gt; Page&lt;T&gt; <span class="hljs-title function_">toMpPage</span><span class="hljs-params">()</span> &#123;<br>        Page&lt;T&gt; page = Page.of(pageNo, pageSize);<br>        <span class="hljs-comment">// 有排序字段则按传入规则排序，否则默认按update_time降序</span><br>        <span class="hljs-keyword">if</span> (sortBy != <span class="hljs-literal">null</span> &amp;&amp; !sortBy.trim().isEmpty()) &#123;<br>            page.addOrder(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderItem</span>().setColumn(sortBy).setAsc(isAsc));<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            page.addOrder(OrderItem.desc(<span class="hljs-string">&quot;update_time&quot;</span>));<br>        &#125;<br>        <span class="hljs-keyword">return</span> page;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 自定义默认排序（覆盖默认的update_time降序）</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> &lt;T&gt; Page&lt;T&gt; <span class="hljs-title function_">toMpPage</span><span class="hljs-params">(String defaultSortBy, Boolean defaultAsc)</span> &#123;<br>        Page&lt;T&gt; page = Page.of(pageNo, pageSize);<br>        <span class="hljs-keyword">if</span> (sortBy != <span class="hljs-literal">null</span> &amp;&amp; !sortBy.trim().isEmpty()) &#123;<br>            page.addOrder(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderItem</span>().setColumn(sortBy).setAsc(isAsc));<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            page.addOrder(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderItem</span>().setColumn(defaultSortBy).setAsc(defaultAsc));<br>        &#125;<br>        <span class="hljs-keyword">return</span> page;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="2-业务查询条件（UserQueryDTO）">2. 业务查询条件（UserQueryDTO）</h4>
<p>继承 <code>PageDTO</code>，添加用户查询的业务条件（如用户名、状态）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;<br><span class="hljs-keyword">import</span> com.itheima.mp.domain.po.User;<br><span class="hljs-keyword">import</span> io.swagger.annotations.ApiModel;<br><span class="hljs-keyword">import</span> io.swagger.annotations.ApiModelProperty;<br><span class="hljs-keyword">import</span> lombok.Data;<br><span class="hljs-keyword">import</span> lombok.EqualsAndHashCode;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@EqualsAndHashCode(callSuper = true)</span><br><span class="hljs-meta">@ApiModel(description = &quot;用户分页查询条件&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserQueryDTO</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">PageDTO</span> &#123;<br>    <span class="hljs-meta">@ApiModelProperty(&quot;用户名关键字（模糊查询）&quot;)</span><br>    <span class="hljs-keyword">private</span> String name;<br><br>    <span class="hljs-meta">@ApiModelProperty(&quot;用户状态（1=正常，2=冻结）&quot;)</span><br>    <span class="hljs-keyword">private</span> Integer status;<br><br>    <span class="hljs-meta">@ApiModelProperty(&quot;最小余额&quot;)</span><br>    <span class="hljs-keyword">private</span> Integer minBalance;<br><br>    <span class="hljs-meta">@ApiModelProperty(&quot;最大余额&quot;)</span><br>    <span class="hljs-keyword">private</span> Integer maxBalance;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 转换为Lambda查询条件（封装业务筛选逻辑）</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> LambdaQueryWrapper&lt;User&gt; <span class="hljs-title function_">toQueryWrapper</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;User&gt;()<br>                .like(name != <span class="hljs-literal">null</span>, User::getUsername, name)<br>                .eq(status != <span class="hljs-literal">null</span>, User::getStatus, status)<br>                .ge(minBalance != <span class="hljs-literal">null</span>, User::getBalance, minBalance)<br>                .le(maxBalance != <span class="hljs-literal">null</span>, User::getBalance, maxBalance);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="3-分页结果封装（PageResult）">3. 分页结果封装（PageResult）</h4>
<p>统一分页结果格式，包含总条数、总页数、当前页数据：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> cn.hutool.core.bean.BeanUtil;<br><span class="hljs-keyword">import</span> cn.hutool.core.collection.CollUtil;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;<br><span class="hljs-keyword">import</span> io.swagger.annotations.ApiModel;<br><span class="hljs-keyword">import</span> io.swagger.annotations.ApiModelProperty;<br><span class="hljs-keyword">import</span> lombok.Data;<br><br><span class="hljs-keyword">import</span> java.util.Collections;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.function.Function;<br><span class="hljs-keyword">import</span> java.util.stream.Collectors;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@ApiModel(description = &quot;分页结果&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PageResult</span>&lt;T&gt; &#123;<br>    <span class="hljs-meta">@ApiModelProperty(&quot;总条数&quot;)</span><br>    <span class="hljs-keyword">private</span> Long total;<br><br>    <span class="hljs-meta">@ApiModelProperty(&quot;总页数&quot;)</span><br>    <span class="hljs-keyword">private</span> Long pages;<br><br>    <span class="hljs-meta">@ApiModelProperty(&quot;当前页数据&quot;)</span><br>    <span class="hljs-keyword">private</span> List&lt;T&gt; list;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * PO分页结果转换为VO分页结果（默认属性拷贝）</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> page MP分页结果（PO）</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> voClazz VO类字节码</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> &lt;PO&gt; PO类型</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> &lt;VO&gt; VO类型</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 分页结果（VO）</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;PO, VO&gt; PageResult&lt;VO&gt; <span class="hljs-title function_">of</span><span class="hljs-params">(Page&lt;PO&gt; page, Class&lt;VO&gt; voClazz)</span> &#123;<br>        PageResult&lt;VO&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PageResult</span>&lt;&gt;();<br>        result.setTotal(page.getTotal());<br>        result.setPages(page.getPages());<br><br>        List&lt;PO&gt; records = page.getRecords();<br>        <span class="hljs-keyword">if</span> (CollUtil.isEmpty(records)) &#123;<br>            result.setList(Collections.emptyList());<br>            <span class="hljs-keyword">return</span> result;<br>        &#125;<br><br>        <span class="hljs-comment">// PO → VO 属性拷贝</span><br>        result.setList(BeanUtil.copyToList(records, voClazz));<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 自定义PO→VO转换（支持特殊逻辑，如脱敏、字段处理）</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> page MP分页结果（PO）</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> converter 转换函数</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> &lt;PO&gt; PO类型</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> &lt;VO&gt; VO类型</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 分页结果（VO）</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;PO, VO&gt; PageResult&lt;VO&gt; <span class="hljs-title function_">of</span><span class="hljs-params">(Page&lt;PO&gt; page, Function&lt;PO, VO&gt; converter)</span> &#123;<br>        PageResult&lt;VO&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PageResult</span>&lt;&gt;();<br>        result.setTotal(page.getTotal());<br>        result.setPages(page.getPages());<br><br>        List&lt;PO&gt; records = page.getRecords();<br>        <span class="hljs-keyword">if</span> (CollUtil.isEmpty(records)) &#123;<br>            result.setList(Collections.emptyList());<br>            <span class="hljs-keyword">return</span> result;<br>        &#125;<br><br>        <span class="hljs-comment">// 自定义转换逻辑</span><br>        result.setList(records.stream().map(converter).collect(Collectors.toList()));<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="4-视图对象（UserVO）">4. 视图对象（UserVO）</h4>
<p>返回给前端的用户数据（隐藏敏感字段，如密码）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.itheima.mp.domain.po.UserInfo;<br><span class="hljs-keyword">import</span> com.itheima.mp.enums.UserStatus;<br><span class="hljs-keyword">import</span> io.swagger.annotations.ApiModel;<br><span class="hljs-keyword">import</span> io.swagger.annotations.ApiModelProperty;<br><span class="hljs-keyword">import</span> lombok.Data;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@ApiModel(description = &quot;用户视图对象&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserVO</span> &#123;<br>    <span class="hljs-meta">@ApiModelProperty(&quot;用户ID&quot;)</span><br>    <span class="hljs-keyword">private</span> Long id;<br><br>    <span class="hljs-meta">@ApiModelProperty(&quot;用户名&quot;)</span><br>    <span class="hljs-keyword">private</span> String username;<br><br>    <span class="hljs-meta">@ApiModelProperty(&quot;详细信息&quot;)</span><br>    <span class="hljs-keyword">private</span> UserInfo info;<br><br>    <span class="hljs-meta">@ApiModelProperty(&quot;用户状态&quot;)</span><br>    <span class="hljs-keyword">private</span> UserStatus status;<br><br>    <span class="hljs-meta">@ApiModelProperty(&quot;账户余额&quot;)</span><br>    <span class="hljs-keyword">private</span> Integer balance;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="5-3-2-分页接口开发">5.3.2 分页接口开发</h3>
<p>基于通用实体实现 “用户条件分页查询” 接口，代码简洁且可复用。</p>
<h4 id="1-Controller-层">1. Controller 层</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.itheima.mp.domain.dto.UserQueryDTO;<br><span class="hljs-keyword">import</span> com.itheima.mp.domain.vo.PageResult;<br><span class="hljs-keyword">import</span> com.itheima.mp.domain.vo.UserVO;<br><span class="hljs-keyword">import</span> com.itheima.mp.service.IUserService;<br><span class="hljs-keyword">import</span> io.swagger.annotations.Api;<br><span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/users&quot;)</span><br><span class="hljs-meta">@Api(tags = &quot;用户管理接口&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> IUserService userService;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/page&quot;)</span><br>    <span class="hljs-meta">@ApiOperation(&quot;用户条件分页查询&quot;)</span><br>    <span class="hljs-keyword">public</span> PageResult&lt;UserVO&gt; <span class="hljs-title function_">queryUserByPage</span><span class="hljs-params">(UserQueryDTO queryDTO)</span> &#123;<br>        <span class="hljs-keyword">return</span> userService.queryUserByPage(queryDTO);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="2-Service-层">2. Service 层</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;<br><span class="hljs-keyword">import</span> com.itheima.mp.domain.dto.UserQueryDTO;<br><span class="hljs-keyword">import</span> com.itheima.mp.domain.po.User;<br><span class="hljs-keyword">import</span> com.itheima.mp.domain.vo.PageResult;<br><span class="hljs-keyword">import</span> com.itheima.mp.domain.vo.UserVO;<br><span class="hljs-keyword">import</span> com.itheima.mp.mapper.UserMapper;<br><span class="hljs-keyword">import</span> com.itheima.mp.service.IUserService;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ServiceImpl</span>&lt;UserMapper, User&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IUserService</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> PageResult&lt;UserVO&gt; <span class="hljs-title function_">queryUserByPage</span><span class="hljs-params">(UserQueryDTO queryDTO)</span> &#123;<br>        <span class="hljs-comment">// 1. 转换分页参数（PageDTO → MP Page）</span><br>        Page&lt;User&gt; page = queryDTO.toMpPage();<br><br>        <span class="hljs-comment">// 2. 转换查询条件（UserQueryDTO → LambdaQueryWrapper）</span><br>        Page&lt;User&gt; resultPage = lambdaQuery()<br>                .like(queryDTO.getName() != <span class="hljs-literal">null</span>, User::getUsername, queryDTO.getName())<br>                .eq(queryDTO.getStatus() != <span class="hljs-literal">null</span>, User::getStatus, queryDTO.getStatus())<br>                .ge(queryDTO.getMinBalance() != <span class="hljs-literal">null</span>, User::getBalance, queryDTO.getMinBalance())<br>                .le(queryDTO.getMaxBalance() != <span class="hljs-literal">null</span>, User::getBalance, queryDTO.getMaxBalance())<br>                .page(page);<br><br>        <span class="hljs-comment">// 3. 转换分页结果（PO Page → VO PageResult）</span><br>        <span class="hljs-comment">// 普通转换（属性拷贝）</span><br>        <span class="hljs-comment">// return PageResult.of(resultPage, UserVO.class);</span><br><br>        <span class="hljs-comment">// 自定义转换（示例：用户名脱敏）</span><br>        <span class="hljs-keyword">return</span> PageResult.of(resultPage, user -&gt; &#123;<br>            <span class="hljs-type">UserVO</span> <span class="hljs-variable">vo</span> <span class="hljs-operator">=</span> BeanUtil.copyProperties(user, UserVO.class);<br>            <span class="hljs-comment">// 脱敏逻辑：用户名保留前2位，其余用*代替</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> vo.getUsername();<br>            <span class="hljs-keyword">if</span> (username.length() &gt; <span class="hljs-number">2</span>) &#123;<br>                vo.setUsername(username.substring(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>) + <span class="hljs-string">&quot;*&quot;</span>.repeat(username.length() - <span class="hljs-number">2</span>));<br>            &#125;<br>            <span class="hljs-keyword">return</span> vo;<br>        &#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="5-3-3-接口测试与结果">5.3.3 接口测试与结果</h3>
<h4 id="请求参数（GET）">请求参数（GET）</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">/users/page?pageNo=1&amp;pageSize=2&amp;sortBy=balance&amp;isAsc=false&amp;name=o&amp;status=1<br></code></pre></td></tr></table></figure>
<h4 id="响应结果">响应结果</h4>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;total&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;pages&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;list&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;username&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Ja**&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;info&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;age&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">20</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;intro&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;佛系青年&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;gender&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;male&quot;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;NORMAL&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;balance&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1600</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;username&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Ro**&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;info&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;age&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">19</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;intro&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;青涩少女&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;gender&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;female&quot;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;NORMAL&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;balance&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">600</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>
<h2 id="5-4-插件功能总结">5.4 插件功能总结</h2>
<ol>
<li><strong>分页插件核心价值</strong>：自动拼接分页 SQL，封装分页元数据，避免手动编写 <code>LIMIT</code> 和 count 查询，适配所有单表查询场景。</li>
<li><strong>通用分页实体设计</strong>：通过 <code>PageDTO</code> 封装分页参数转换、<code>PageResult</code> 封装结果，减少重复代码，支持自定义转换逻辑（如脱敏、字段处理）。</li>
<li><strong>多插件组合要点</strong>：严格按 “租户 / 动态表名→分页 / 乐观锁→SQL 规范 / 防全表操作” 的顺序配置，避免拦截逻辑冲突。</li>
</ol>
<p>MyBatis-Plus 插件体系以 “轻量级、可插拔” 为设计理念，既能满足复杂业务需求，又不侵入原有代码，是提升开发效率与系统健壮性的重要工具。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://a1.boltp.com/2025/09/19/68cd6497c1133.png" alt=""></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://www.xwybq.top">xw</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://www.xwybq.top/posts/67c8035e/">https://www.xwybq.top/posts/67c8035e/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://www.xwybq.top" target="_blank">xw的妙妙屋</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MyBatis-Plus/">MyBatis-Plus</a></div><div class="post-share"><div class="social-share" data-image="https://a1.boltp.com/2025/09/19/68cd666550457.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width" href="/posts/54f9cb4a/" title="Spring Boot：自动配置的核心原理"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://a1.boltp.com/2025/08/24/68aaba6415f8f.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Spring Boot：自动配置的核心原理</div></div><div class="info-2"><div class="info-item-1">今天刚学完黑马的 JavaWeb 课程，回想整个过程还挺有感触的。前端部分学起来感觉挺顺的，到了后端，从 Maven 到 SpringBoot 的各种案例，做下来也都还好 —— 无非是搭好架构、引入依赖、标上注解，再写点 CRUD 代码，不算特别复杂。 但学到 Spring Boot 原理这块时，说实话第一遍是真有点懵。这大概是整个 JavaWeb 里，我唯一觉得抽象的部分了。后来又反复听了两三遍，自己也翻了翻源码，才算有了点初步的理解。 其实我们都感受过 Spring Boot “开箱即用” 的神奇 —— 只要引入依赖、写几行代码，一个能跑的应用很快就能启动起来。这背后，正是 Spring Boot 精心设计的自动配置机制在悄悄发力。今天就结合最新版本的特点，跟大家聊聊我对 Spring Boot 核心原理的理解。 一、从 “配置地狱” 到 “零配置” 的跨越 在 Spring Boot 出现之前，我们用 Spring 框架开发时，总得写一大堆 XML 配置或者 Java 配置类：声明 Bean、配置扫描路径、设置依赖注入关系…… 这些重复的工作被开发者们调侃成 “配置地狱”。...</div></div></div></a></nav><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/headshot.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">xw</div><div class="author-info-description">白天写BUG，夜里写诗，偶尔人间失焦，却一直在发光。</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">12</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">14</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xwybq"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/xwybq" target="_blank" title="Github"><i class="fab fa-github" style="color: #hdhfbb;"></i></a><a class="social-icon" href="mailto:w3290819205@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #000000;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content"><p>⚙️ 框架核心：Hexo</p>
<p>🕹️ 界面设计：Butterfly</p>
<p>🔮 域名托管：雨云</p>
<p>🎰 部署平台：GitHub Pages + Vercel</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog.liushen.fun/config/img/notice.gif" alt="gif" style="width:100%;border-radius:8px;margin-top:8px;">
</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">一、MyBatis-Plus 简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E4%BB%80%E4%B9%88%E6%98%AF-MyBatis-Plus"><span class="toc-text">1.1 什么是 MyBatis-Plus</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7"><span class="toc-text">1.2 核心特性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-%E6%94%AF%E6%8C%81%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">1.3 支持的数据库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-%E6%A1%86%E6%9E%B6%E7%BB%93%E6%9E%84"><span class="toc-text">1.4 框架结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-5-%E5%AE%98%E6%96%B9%E8%B5%84%E6%BA%90"><span class="toc-text">1.5 官方资源</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">二、MyBatis-Plus 快速入门</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-text">2.1 环境准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-1-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-text">2.1.1 数据库初始化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-2-%E9%A1%B9%E7%9B%AE%E5%AF%BC%E5%85%A5%E4%B8%8E%E9%85%8D%E7%BD%AE"><span class="toc-text">2.1.2 项目导入与配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-MyBatis-%E9%A1%B9%E7%9B%AE%E6%94%B9%E9%80%A0%E4%B8%BA-MyBatis-Plus"><span class="toc-text">2.2 MyBatis 项目改造为 MyBatis-Plus</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1-%E6%AD%A5%E9%AA%A4-1%EF%BC%9A%E6%9B%BF%E6%8D%A2%E4%BE%9D%E8%B5%96"><span class="toc-text">2.2.1 步骤 1：替换依赖</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Spring-Boot-2-x-%E4%BE%9D%E8%B5%96"><span class="toc-text">Spring Boot 2.x 依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Spring-Boot-3-x-%E4%BE%9D%E8%B5%96"><span class="toc-text">Spring Boot 3.x 依赖</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2-%E6%AD%A5%E9%AA%A4-2%EF%BC%9A%E9%85%8D%E7%BD%AE-Mapper-%E6%89%AB%E6%8F%8F"><span class="toc-text">2.2.2 步骤 2：配置 Mapper 扫描</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-3-%E6%AD%A5%E9%AA%A4-3%EF%BC%9A%E5%AE%9A%E4%B9%89-Mapper-%E6%8E%A5%E5%8F%A3%EF%BC%88%E6%A0%B8%E5%BF%83%E6%94%B9%E9%80%A0%EF%BC%89"><span class="toc-text">2.2.3 步骤 3：定义 Mapper 接口（核心改造）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%94%B9%E9%80%A0%E5%89%8D%EF%BC%88MyBatis%EF%BC%89"><span class="toc-text">改造前（MyBatis）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%94%B9%E9%80%A0%E5%90%8E%EF%BC%88MyBatis-Plus%EF%BC%89"><span class="toc-text">改造后（MyBatis-Plus）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-4-%E6%94%B9%E9%80%A0%E6%95%88%E6%9E%9C%E6%B5%8B%E8%AF%95"><span class="toc-text">2.2.4 改造效果测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-%E5%B8%B8%E8%A7%81%E6%B3%A8%E8%A7%A3"><span class="toc-text">2.3 常见注解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-1-%E6%A0%B8%E5%BF%83%E6%B3%A8%E8%A7%A3%E8%AF%B4%E6%98%8E"><span class="toc-text">2.3.1 核心注解说明</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-TableName%EF%BC%9A%E6%8C%87%E5%AE%9A%E8%A1%A8%E5%90%8D"><span class="toc-text">1. @TableName：指定表名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-TableId%EF%BC%9A%E6%8C%87%E5%AE%9A%E4%B8%BB%E9%94%AE"><span class="toc-text">2. @TableId：指定主键</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-TableField%EF%BC%9A%E6%8C%87%E5%AE%9A%E6%99%AE%E9%80%9A%E5%AD%97%E6%AE%B5"><span class="toc-text">3. @TableField：指定普通字段</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-2-%E6%B3%A8%E8%A7%A3%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B"><span class="toc-text">2.3.2 注解使用案例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%AE%9A%E4%B9%89-PO-%E5%AE%9E%E4%BD%93%E7%B1%BB%EF%BC%88MpUser%EF%BC%89"><span class="toc-text">1. 定义 PO 实体类（MpUser）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%B5%8B%E8%AF%95%E6%B3%A8%E8%A7%A3%E6%95%88%E6%9E%9C"><span class="toc-text">2. 测试注解效果</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-%E5%B8%B8%E8%A7%81%E9%85%8D%E7%BD%AE"><span class="toc-text">2.4 常见配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-1-%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B"><span class="toc-text">2.4.1 核心配置示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-2-%E5%85%B3%E9%94%AE%E9%85%8D%E7%BD%AE%E8%AF%B4%E6%98%8E"><span class="toc-text">2.4.2 关键配置说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-3-%E9%85%8D%E7%BD%AE%E4%BC%98%E5%85%88%E7%BA%A7"><span class="toc-text">2.4.3 配置优先级</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">三、MyBatis-Plus 核心功能</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E6%9D%A1%E4%BB%B6%E6%9E%84%E9%80%A0%E5%99%A8%EF%BC%9A%E5%8A%A8%E6%80%81-SQL-%E4%BC%98%E9%9B%85%E5%AE%9E%E7%8E%B0"><span class="toc-text">3.1 条件构造器：动态 SQL 优雅实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-1-Wrapper-%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84"><span class="toc-text">3.1.1 Wrapper 体系结构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%A7%E6%89%BF%E5%85%B3%E7%B3%BB"><span class="toc-text">继承关系</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E7%B1%BB%E4%BD%9C%E7%94%A8"><span class="toc-text">核心类作用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-2-QueryWrapper%EF%BC%9A%E6%9F%A5%E8%AF%A2%E4%B8%8E%E7%AE%80%E5%8D%95%E6%9B%B4%E6%96%B0-%E5%88%A0%E9%99%A4"><span class="toc-text">3.1.2 QueryWrapper：查询与简单更新 &#x2F; 删除</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%A4%8D%E6%9D%82%E6%9F%A5%E8%AF%A2%E7%A4%BA%E4%BE%8B"><span class="toc-text">1. 复杂查询示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%9F%BA%E4%BA%8E%E6%9D%A1%E4%BB%B6%E7%9A%84%E6%9B%B4%E6%96%B0"><span class="toc-text">2. 基于条件的更新</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%9F%BA%E4%BA%8E%E6%9D%A1%E4%BB%B6%E7%9A%84%E5%88%A0%E9%99%A4"><span class="toc-text">3. 基于条件的删除</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-3-UpdateWrapper%EF%BC%9A%E5%A4%8D%E6%9D%82%E6%9B%B4%E6%96%B0%E5%9C%BA%E6%99%AF"><span class="toc-text">3.1.3 UpdateWrapper：复杂更新场景</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%9F%BA%E4%BA%8E%E5%AD%97%E6%AE%B5%E7%8E%B0%E6%9C%89%E5%80%BC%E7%9A%84%E6%9B%B4%E6%96%B0"><span class="toc-text">1. 基于字段现有值的更新</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E7%BB%84%E5%90%88%E6%9B%B4%E6%96%B0%EF%BC%88SET-%E5%A4%9A%E5%AD%97%E6%AE%B5%EF%BC%89"><span class="toc-text">2. 组合更新（SET 多字段）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-4-Lambda-%E6%9D%A1%E4%BB%B6%E6%9E%84%E9%80%A0%E5%99%A8%EF%BC%9A%E9%81%BF%E5%85%8D%E7%A1%AC%E7%BC%96%E7%A0%81"><span class="toc-text">3.1.4 Lambda 条件构造器：避免硬编码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-LambdaQueryWrapper-%E7%A4%BA%E4%BE%8B"><span class="toc-text">1. LambdaQueryWrapper 示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-LambdaUpdateWrapper-%E7%A4%BA%E4%BE%8B"><span class="toc-text">2. LambdaUpdateWrapper 示例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-5-%E5%B8%B8%E7%94%A8%E6%9D%A1%E4%BB%B6%E6%96%B9%E6%B3%95%E9%80%9F%E6%9F%A5%E8%A1%A8"><span class="toc-text">3.1.5 常用条件方法速查表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-6-%E6%9D%A1%E4%BB%B6%E6%9E%84%E9%80%A0%E5%99%A8%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93"><span class="toc-text">3.1.6 条件构造器使用总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E8%87%AA%E5%AE%9A%E4%B9%89-SQL-%E4%B8%8E-IService-%E6%8E%A5%E5%8F%A3%EF%BC%9A%E5%88%86%E5%B1%82%E5%BC%80%E5%8F%91%E6%95%88%E7%8E%87%E6%8F%90%E5%8D%87"><span class="toc-text">3.2 自定义 SQL 与 IService 接口：分层开发效率提升</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-1-%E8%87%AA%E5%AE%9A%E4%B9%89-SQL%EF%BC%9A%E9%80%82%E9%85%8D%E7%89%B9%E6%AE%8A%E9%80%BB%E8%BE%91%E4%B8%8E%E5%A4%9A%E8%A1%A8%E5%9C%BA%E6%99%AF"><span class="toc-text">3.2.1 自定义 SQL：适配特殊逻辑与多表场景</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%A0%B8%E5%BF%83%E5%9C%BA%E6%99%AF%EF%BC%9A%E9%81%BF%E5%85%8D-SQL-%E7%A1%AC%E7%BC%96%E7%A0%81%E5%88%B0%E4%B8%9A%E5%8A%A1%E5%B1%82"><span class="toc-text">1. 核心场景：避免 SQL 硬编码到业务层</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E5%BC%95%E5%87%BA"><span class="toc-text">问题引出</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%EF%BC%9AWrapper-%E8%87%AA%E5%AE%9A%E4%B9%89-SQL-%E7%89%87%E6%AE%B5"><span class="toc-text">解决方案：Wrapper + 自定义 SQL 片段</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="toc-text">实现步骤</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B%EF%BC%9A%E5%AD%97%E6%AE%B5%E8%87%AA%E5%87%8F%E6%9B%B4%E6%96%B0"><span class="toc-text">代码示例：字段自减更新</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-Service-%E5%B1%82%EF%BC%9A%E6%9E%84%E5%BB%BA%E6%9D%A1%E4%BB%B6"><span class="toc-text">1. Service 层：构建条件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-Mapper-%E5%B1%82%EF%BC%9A%E8%87%AA%E5%AE%9A%E4%B9%89-SQL-%E7%89%87%E6%AE%B5"><span class="toc-text">2. Mapper 层：自定义 SQL 片段</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E7%94%9F%E6%88%90%E7%9A%84-SQL"><span class="toc-text">3. 生成的 SQL</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E8%BF%9B%E9%98%B6%E5%9C%BA%E6%99%AF%EF%BC%9A%E5%A4%9A%E8%A1%A8%E8%81%94%E6%9F%A5"><span class="toc-text">2. 进阶场景：多表联查</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-Service-%E5%B1%82%EF%BC%9A%E6%9E%84%E5%BB%BA%E5%A4%9A%E8%A1%A8%E6%9D%A1%E4%BB%B6"><span class="toc-text">1. Service 层：构建多表条件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-Mapper-%E5%B1%82%EF%BC%9A%E8%87%AA%E5%AE%9A%E4%B9%89%E5%A4%9A%E8%A1%A8-SQL"><span class="toc-text">2. Mapper 层：自定义多表 SQL</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E7%94%9F%E6%88%90%E7%9A%84-SQL-2"><span class="toc-text">3. 生成的 SQL</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E8%87%AA%E5%AE%9A%E4%B9%89-SQL-%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF%E6%80%BB%E7%BB%93"><span class="toc-text">3. 自定义 SQL 适用场景总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-2-IService-%E6%8E%A5%E5%8F%A3%EF%BC%9AService-%E5%B1%82%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E5%B0%81%E8%A3%85"><span class="toc-text">3.2.2 IService 接口：Service 层模板方法封装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-IService-%E6%A0%B8%E5%BF%83%E8%AE%BE%E8%AE%A1"><span class="toc-text">1. IService 核心设计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%A0%B8%E5%BF%83%E6%96%B9%E6%B3%95%E5%88%86%E7%B1%BB%EF%BC%88%E9%AB%98%E9%A2%91%EF%BC%89"><span class="toc-text">2. 核心方法分类（高频）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E6%B5%81%E7%A8%8B"><span class="toc-text">3. 基本使用流程</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4-1%EF%BC%9A%E5%AE%9A%E4%B9%89%E8%87%AA%E5%AE%9A%E4%B9%89-Service-%E6%8E%A5%E5%8F%A3"><span class="toc-text">步骤 1：定义自定义 Service 接口</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4-2%EF%BC%9A%E5%AE%9E%E7%8E%B0-Service-%E7%B1%BB"><span class="toc-text">步骤 2：实现 Service 类</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4-3%EF%BC%9AController-%E5%B1%82%E8%B0%83%E7%94%A8"><span class="toc-text">步骤 3：Controller 层调用</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E8%BF%9B%E9%98%B6%EF%BC%9ALambdaQuery-%E4%B8%8E-LambdaUpdate%EF%BC%88%E9%AB%98%E6%95%88%EF%BC%81%EF%BC%89"><span class="toc-text">4. 进阶：LambdaQuery 与 LambdaUpdate（高效！）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF-1%EF%BC%9A%E5%8A%A8%E6%80%81%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2"><span class="toc-text">场景 1：动态条件查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%AE%9A%E4%B9%89%E6%9F%A5%E8%AF%A2-DTO"><span class="toc-text">1. 定义查询 DTO</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-Service-%E5%B1%82%E5%AE%9E%E7%8E%B0"><span class="toc-text">2. Service 层实现</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF-2%EF%BC%9A%E5%8A%A8%E6%80%81%E6%9B%B4%E6%96%B0"><span class="toc-text">场景 2：动态更新</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%EF%BC%9A%E6%89%B9%E9%87%8F%E6%96%B0%E5%A2%9E%E4%B8%8E%E6%89%B9%E5%A4%84%E7%90%86"><span class="toc-text">5. 性能优化：批量新增与批处理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%89%E7%A7%8D%E6%89%B9%E9%87%8F%E6%8F%92%E5%85%A5%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94"><span class="toc-text">三种批量插入方案对比</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E9%85%8D%E7%BD%AE%EF%BC%9A%E5%BC%80%E5%90%AF-MySQL-%E6%89%B9%E5%A4%84%E7%90%86"><span class="toc-text">关键配置：开启 MySQL 批处理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-text">注意事项</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-IService-%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93"><span class="toc-text">6. IService 使用总结</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">四、MyBatis-Plus 扩展功能</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%EF%BC%9A%E4%B8%80%E9%94%AE%E7%94%9F%E6%88%90%E9%87%8D%E5%A4%8D%E4%BB%A3%E7%A0%81"><span class="toc-text">4.1 代码生成：一键生成重复代码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-1-%E6%96%B9%E6%A1%88%E4%B8%80%EF%BC%9AIdea-%E6%8F%92%E4%BB%B6%E7%94%9F%E6%88%90%EF%BC%88%E6%8E%A8%E8%8D%90%E6%96%B0%E6%89%8B%EF%BC%89"><span class="toc-text">4.1.1 方案一：Idea 插件生成（推荐新手）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%AE%89%E8%A3%85%E6%8F%92%E4%BB%B6"><span class="toc-text">1. 安装插件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4"><span class="toc-text">2. 使用步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-2-%E6%96%B9%E6%A1%88%E4%BA%8C%EF%BC%9A%E5%AE%98%E6%96%B9%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E5%99%A8%EF%BC%88%E7%81%B5%E6%B4%BB%E5%AE%9A%E5%88%B6%EF%BC%8C%E5%8F%AF%E8%B7%B3%E8%BF%87%EF%BC%89"><span class="toc-text">4.1.2 方案二：官方代码生成器（灵活定制，可跳过）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-text">1. 引入依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E7%BC%96%E5%86%99%E7%94%9F%E6%88%90%E9%85%8D%E7%BD%AE"><span class="toc-text">2. 编写生成配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%89%A7%E8%A1%8C%E7%94%9F%E6%88%90"><span class="toc-text">3. 执行生成</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E9%9D%99%E6%80%81%E5%B7%A5%E5%85%B7-Db%EF%BC%9A%E8%A7%A3%E5%86%B3-Service-%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96"><span class="toc-text">4.2 静态工具 Db：解决 Service 循环依赖</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-1-%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7"><span class="toc-text">4.2.1 核心特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-2-%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="toc-text">4.2.2 基础使用示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-3-%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B%EF%BC%9A%E6%9F%A5%E8%AF%A2%E7%94%A8%E6%88%B7%E5%8F%8A%E5%85%B3%E8%81%94%E5%9C%B0%E5%9D%80"><span class="toc-text">4.2.3 实战案例：查询用户及关联地址</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B-1%EF%BC%9A%E6%9F%A5%E8%AF%A2%E5%8D%95%E4%B8%AA%E7%94%A8%E6%88%B7%E5%8F%8A%E5%9C%B0%E5%9D%80"><span class="toc-text">案例 1：查询单个用户及地址</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B-2%EF%BC%9A%E6%89%B9%E9%87%8F%E6%9F%A5%E8%AF%A2%E7%94%A8%E6%88%B7%E5%8F%8A%E5%9C%B0%E5%9D%80"><span class="toc-text">案例 2：批量查询用户及地址</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-%E9%80%BB%E8%BE%91%E5%88%A0%E9%99%A4%EF%BC%9A%E9%81%BF%E5%85%8D%E6%95%B0%E6%8D%AE%E7%89%A9%E7%90%86%E5%88%A0%E9%99%A4"><span class="toc-text">4.3 逻辑删除：避免数据物理删除</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-1-%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="toc-text">4.3.1 实现步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%B7%BB%E5%8A%A0%E9%80%BB%E8%BE%91%E5%88%A0%E9%99%A4%E5%AD%97%E6%AE%B5"><span class="toc-text">1. 数据库添加逻辑删除字段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E9%85%8D%E7%BD%AE%E9%80%BB%E8%BE%91%E5%88%A0%E9%99%A4"><span class="toc-text">2. 配置逻辑删除</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F-1%EF%BC%9A%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE%EF%BC%88%E6%8E%A8%E8%8D%90%EF%BC%89"><span class="toc-text">方式 1：全局配置（推荐）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F-2%EF%BC%9A%E6%B3%A8%E8%A7%A3%E9%85%8D%E7%BD%AE%EF%BC%88%E5%8D%95%E8%A1%A8%E8%87%AA%E5%AE%9A%E4%B9%89%EF%BC%89"><span class="toc-text">方式 2：注解配置（单表自定义）</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%B5%8B%E8%AF%95%E9%80%BB%E8%BE%91%E5%88%A0%E9%99%A4"><span class="toc-text">3. 测试逻辑删除</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-2-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-text">4.3.2 注意事项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-%E6%9E%9A%E4%B8%BE%E5%A4%84%E7%90%86%E5%99%A8%EF%BC%9A%E6%9E%9A%E4%B8%BE%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AD%97%E6%AE%B5%E8%87%AA%E5%8A%A8%E8%BD%AC%E6%8D%A2"><span class="toc-text">4.4 枚举处理器：枚举与数据库字段自动转换</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-1-%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="toc-text">4.4.1 实现步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%AE%9A%E4%B9%89%E6%9E%9A%E4%B8%BE%E5%B9%B6%E6%A0%87%E8%AE%B0-EnumValue"><span class="toc-text">1. 定义枚举并标记 @EnumValue</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E9%85%8D%E7%BD%AE%E5%85%A8%E5%B1%80%E6%9E%9A%E4%B8%BE%E5%A4%84%E7%90%86%E5%99%A8"><span class="toc-text">2. 配置全局枚举处理器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%94%B9%E9%80%A0-PO-%E7%B1%BB"><span class="toc-text">3. 改造 PO 类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-2-%E6%B5%8B%E8%AF%95%E6%95%88%E6%9E%9C"><span class="toc-text">4.4.2 测试效果</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-5-JSON-%E7%B1%BB%E5%9E%8B%E5%A4%84%E7%90%86%E5%99%A8%EF%BC%9AJSON-%E5%AD%97%E6%AE%B5%E4%B8%8E%E5%AF%B9%E8%B1%A1%E8%87%AA%E5%8A%A8%E8%BD%AC%E6%8D%A2"><span class="toc-text">4.5 JSON 类型处理器：JSON 字段与对象自动转换</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-1-%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="toc-text">4.5.1 实现步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%AE%9A%E4%B9%89-JSON-%E5%AF%B9%E5%BA%94%E7%9A%84%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="toc-text">1. 定义 JSON 对应的实体类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%94%B9%E9%80%A0-PO-%E7%B1%BB"><span class="toc-text">2. 改造 PO 类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%B5%8B%E8%AF%95%E8%87%AA%E5%8A%A8%E8%BD%AC%E6%8D%A2"><span class="toc-text">3. 测试自动转换</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-6-YAML-%E9%85%8D%E7%BD%AE%E5%8A%A0%E5%AF%86%EF%BC%9A%E4%BF%9D%E6%8A%A4%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF"><span class="toc-text">4.6 YAML 配置加密：保护敏感信息</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-1-%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="toc-text">4.6.1 实现步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E7%94%9F%E6%88%90%E5%AF%86%E9%92%A5%E4%B8%8E%E5%AF%86%E6%96%87"><span class="toc-text">1. 生成密钥与密文</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">2. 修改配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E9%85%8D%E7%BD%AE%E5%90%AF%E5%8A%A8%E5%AF%86%E9%92%A5"><span class="toc-text">3. 配置启动密钥</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-2-%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="toc-text">4.6.2 实现原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-7-%E8%87%AA%E5%8A%A8%E5%A1%AB%E5%85%85%EF%BC%9A%E5%AD%97%E6%AE%B5%E5%80%BC%E8%87%AA%E5%8A%A8%E8%B5%8B%E5%80%BC"><span class="toc-text">4.7 自动填充：字段值自动赋值</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-7-1-%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="toc-text">4.7.1 实现步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%AE%9E%E7%8E%B0%E5%A1%AB%E5%85%85%E5%A4%84%E7%90%86%E5%99%A8"><span class="toc-text">1. 实现填充处理器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%A0%87%E8%AE%B0-PO-%E7%B1%BB%E5%AD%97%E6%AE%B5"><span class="toc-text">2. 标记 PO 类字段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%B5%8B%E8%AF%95%E8%87%AA%E5%8A%A8%E5%A1%AB%E5%85%85"><span class="toc-text">3. 测试自动填充</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-7-2-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-text">4.7.2 注意事项</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">五、MyBatis-Plus 插件功能</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-%E6%8F%92%E4%BB%B6%E4%BD%93%E7%B3%BB%E6%A6%82%E8%BF%B0"><span class="toc-text">5.1 插件体系概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-1-%E6%8F%92%E4%BB%B6%E9%85%8D%E7%BD%AE%E9%A1%BA%E5%BA%8F"><span class="toc-text">5.1.1 插件配置顺序</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-%E6%A0%B8%E5%BF%83%E6%8F%92%E4%BB%B6%EF%BC%9A%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6%EF%BC%88PaginationInnerInterceptor%EF%BC%89"><span class="toc-text">5.2 核心插件：分页插件（PaginationInnerInterceptor）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-1-%E6%AD%A5%E9%AA%A4-1%EF%BC%9A%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-text">5.2.1 步骤 1：引入依赖</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#JDK-11-%E4%BE%9D%E8%B5%96"><span class="toc-text">JDK 11+ 依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JDK-8-%E4%BE%9D%E8%B5%96"><span class="toc-text">JDK 8+ 依赖</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-2-%E6%AD%A5%E9%AA%A4-2%EF%BC%9A%E9%85%8D%E7%BD%AE%E5%88%86%E9%A1%B5%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-text">5.2.2 步骤 2：配置分页拦截器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-3-%E6%AD%A5%E9%AA%A4-3%EF%BC%9A%E4%BD%BF%E7%94%A8%E5%88%86%E9%A1%B5-API"><span class="toc-text">5.2.3 步骤 3：使用分页 API</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E5%88%86%E9%A1%B5%E7%A4%BA%E4%BE%8B"><span class="toc-text">基础分页示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C"><span class="toc-text">分页查询结果</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E7%9A%84-SQL"><span class="toc-text">生成的 SQL</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-%E5%AE%9E%E6%88%98%EF%BC%9A%E9%80%9A%E7%94%A8%E5%88%86%E9%A1%B5%E5%AE%9E%E4%BD%93%E8%AE%BE%E8%AE%A1%E4%B8%8E%E4%BC%98%E5%8C%96"><span class="toc-text">5.3 实战：通用分页实体设计与优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-1-%E6%A0%B8%E5%BF%83%E5%AE%9E%E4%BD%93%E7%B1%BB%E8%AE%BE%E8%AE%A1"><span class="toc-text">5.3.1 核心实体类设计</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E9%80%9A%E7%94%A8%E5%88%86%E9%A1%B5%E5%8F%82%E6%95%B0%EF%BC%88PageDTO%EF%BC%89"><span class="toc-text">1. 通用分页参数（PageDTO）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E4%B8%9A%E5%8A%A1%E6%9F%A5%E8%AF%A2%E6%9D%A1%E4%BB%B6%EF%BC%88UserQueryDTO%EF%BC%89"><span class="toc-text">2. 业务查询条件（UserQueryDTO）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%88%86%E9%A1%B5%E7%BB%93%E6%9E%9C%E5%B0%81%E8%A3%85%EF%BC%88PageResult%EF%BC%89"><span class="toc-text">3. 分页结果封装（PageResult）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E8%A7%86%E5%9B%BE%E5%AF%B9%E8%B1%A1%EF%BC%88UserVO%EF%BC%89"><span class="toc-text">4. 视图对象（UserVO）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-2-%E5%88%86%E9%A1%B5%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91"><span class="toc-text">5.3.2 分页接口开发</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-Controller-%E5%B1%82"><span class="toc-text">1. Controller 层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-Service-%E5%B1%82"><span class="toc-text">2. Service 层</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-3-%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95%E4%B8%8E%E7%BB%93%E6%9E%9C"><span class="toc-text">5.3.3 接口测试与结果</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%EF%BC%88GET%EF%BC%89"><span class="toc-text">请求参数（GET）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E7%BB%93%E6%9E%9C"><span class="toc-text">响应结果</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-4-%E6%8F%92%E4%BB%B6%E5%8A%9F%E8%83%BD%E6%80%BB%E7%BB%93"><span class="toc-text">5.4 插件功能总结</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/67c8035e/" title="MyBatis-Plus"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://a1.boltp.com/2025/09/19/68cd666550457.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MyBatis-Plus"/></a><div class="content"><a class="title" href="/posts/67c8035e/" title="MyBatis-Plus">MyBatis-Plus</a><time datetime="2025-09-19T07:31:42.000Z" title="发表于 2025-09-19 15:31:42">2025-09-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/54f9cb4a/" title="Spring Boot：自动配置的核心原理"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://a1.boltp.com/2025/08/24/68aaba6415f8f.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spring Boot：自动配置的核心原理"/></a><div class="content"><a class="title" href="/posts/54f9cb4a/" title="Spring Boot：自动配置的核心原理">Spring Boot：自动配置的核心原理</a><time datetime="2025-08-24T06:53:08.000Z" title="发表于 2025-08-24 14:53:08">2025-08-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/48bcc160/" title="解决Hexo相册滚动时图片消失的问题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://a1.boltp.com/2025/08/22/68a82df762f24.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="解决Hexo相册滚动时图片消失的问题"/></a><div class="content"><a class="title" href="/posts/48bcc160/" title="解决Hexo相册滚动时图片消失的问题">解决Hexo相册滚动时图片消失的问题</a><time datetime="2025-08-22T07:06:05.000Z" title="发表于 2025-08-22 15:06:05">2025-08-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/a3c9f8a9/" title="谷歌账号注册教程"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://tc-new.z.wiki/autoupload/f/ucStas0fz6Urti1KaUxkGn8gdyy46VE3EBgpLh8QvIiyl5f0KlZfm6UsKj-HyTuv/20250820/woVo/1024X1024/google-color.webp/webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="谷歌账号注册教程"/></a><div class="content"><a class="title" href="/posts/a3c9f8a9/" title="谷歌账号注册教程">谷歌账号注册教程</a><time datetime="2025-08-19T16:00:00.000Z" title="发表于 2025-08-20 00:00:00">2025-08-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/99f768c5/" title="2022年上海市大学生程序设计竞赛"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://tc-new.z.wiki/autoupload/f/ucStas0fz6Urti1KaUxkGn8gdyy46VE3EBgpLh8QvIiyl5f0KlZfm6UsKj-HyTuv/20250820/BqTi/500X492/image.png/webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2022年上海市大学生程序设计竞赛"/></a><div class="content"><a class="title" href="/posts/99f768c5/" title="2022年上海市大学生程序设计竞赛">2022年上海市大学生程序设计竞赛</a><time datetime="2025-08-18T15:18:27.000Z" title="发表于 2025-08-18 23:18:27">2025-08-18</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By xw</span></div><div class="footer_custom_text"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://haiyong.site/img/icp.png"><a href="https://beian.miit.gov.cn/#/Integrated/index" style="color:black" target="_blank">豫ICP备147号-1</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = {"COMMENT_PLACEHOLDER":"来留下你的精彩评论吧！输入 QQ 号还能自动显示邮箱和头像哦～"}

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.xwybq.top',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = (el = document, path = location.pathname) => {
    twikoo.init({
      el: el.querySelector('#twikoo-wrap'),
      envId: 'https://twikoo.xwybq.top',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      },
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    

    isShuoshuo && (window.shuoshuoComment.destroyTwikoo = () => {
      if (el.children.length) {
        el.innerHTML = ''
        el.classList.add('no-comment')
      }
    })
  }

  const loadTwikoo = (el, path) => {
    if (typeof twikoo === 'object') setTimeout(() => init(el, path), 0)
    else btf.getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(() => init(el, path))
  }

  if (isShuoshuo) {
    'Twikoo' === 'Twikoo'
      ? window.shuoshuoComment = { loadComment: loadTwikoo }
      : window.loadOtherComment = loadTwikoo
    return
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script src="/js/weather.js"></script><script src="/styles/fish.js"></script><script type="text/javascript" src="/js/daliyuer.js"></script><div class="aplayer no-destroy" data-id="732801999" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listFolded="false" data-order="list" data-preload="none" data-autoplay="false" muted></div><script src="/js/beauty.js"></script><script src="/js/canvas-nest.js"></script><script src="/js/foot.js"></script><script src="/js/happy-title.js"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script>(() => {
  const destroyAplayer = () => {
    if (window.aplayers) {
      for (let i = 0; i < window.aplayers.length; i++) {
        if (!window.aplayers[i].options.fixed) {
          window.aplayers[i].destroy()
        }
      }
    }
  }

  const runMetingJS = () => {
    typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()
  }

  btf.addGlobalFn('pjaxSend', destroyAplayer, 'destroyAplayer')
  btf.addGlobalFn('pjaxComplete', loadMeting, 'runMetingJS')
})()</script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>(() => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => fn())
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      const usePjax = true
      false
        ? (usePjax ? pjax.loadUrl('/404.html') : window.location.href = '/404.html')
        : window.location.href = e.request.responseURL
    }
  })
})()</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="请输入内容" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div><!-- hexo injector body_end start --><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '1500ms');
    arr[i].setAttribute('data-wow-delay', '0ms');
    arr[i].setAttribute('data-wow-offset', '0');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '1500ms');
    arr[i].setAttribute('data-wow-delay', '0ms');
    arr[i].setAttribute('data-wow-offset', '0');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('container');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '1500ms');
    arr[i].setAttribute('data-wow-delay', '0ms');
    arr[i].setAttribute('data-wow-offset', '0');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script></div><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right","width":130,"height":270,"hOffset":40,"vOffset":-40},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/"});</script></body></html>